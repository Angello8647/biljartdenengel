<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Biljart Score App</title>
    <style>
        /* ========== LOGIN STYLES ========== */
        #loginPage {
            background: linear-gradient(135deg, #2c3e50, #4a6491);
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 1000;
        }
        
        .login-container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            text-align: center;
            max-width: 400px;
            width: 100%;
        }
        
        .login-container h1 {
            color: #2c3e50;
            margin-bottom: 30px;
        }
        
        .password-input {
            width: 100%;
            padding: 15px;
            font-size: 18px;
            border: 2px solid #3498db;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .login-btn {
            background: #2ecc71;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            transition: background 0.3s;
        }
        
        .login-btn:hover {
            background: #27ae60;
        }
        
        .error-message {
            color: #e74c3c;
            margin-top: 15px;
            display: none;
        }
        
        .app-info {
            margin-top: 25px;
            color: #7f8c8d;
            font-size: 14px;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        /* ========== APP STYLES ========== */
        #appContainer {
            display: none;
        }
        
        body.logged-in #loginPage {
            display: none;
        }
        
        body.logged-in #appContainer {
            display: block;
        }
        
        /* ALLE STIJLEN VAN DE BILJART APP */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }
        
        body { 
            background: #2c3e50; 
            color: black;
            position: fixed;
            width: 100%;
            height: 100%;
            overflow: hidden !important;
        }
        
        .page { 
            display: none; 
            padding: 10px;
            overflow-y: auto !important;
            height: calc(100vh - 20px) !important;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }
        
        .active { display: block; }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #34495e;
        }
        
        .header h1 {
            font-size: 1.5em;
            margin: 0;
        }
        
        .back-btn {
            background: #7f8c8d;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
        }

        /* Nieuwe style voor header knoppen tijdens match */
        .header-buttons-hidden {
            display: none !important;
        }
        
        .home-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            margin-right: 10px;
        }
        
        .match-card {
            background: #34495e;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            cursor: pointer;
            position: relative;
        }
        
        .match-card.completed {
            opacity: 0.7;
            background: #2c3e50;
            border-left: 5px solid #27ae60;
        }
        
        .match-card.downloaded {
            opacity: 0.6;
            background: #2c3e50;
            border-left: 5px solid #3498db;
        }
        
        .delete-match-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #e74c3c;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .players-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 10px 0;
        }
        
        .player-card {
            border-radius: 15px;
            padding: 15px;
            font-size: 1.1em;
            transition: all 0.3s;
            min-height: 280px;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        
        .player-active {
            border: 4px solid #e74c3c;
            box-shadow: 0 0 10px rgba(231, 76, 60, 0.5);
        }
        
        .player-inactive {
            opacity: 0.7;
            border: 4px solid transparent;
        }
        
        .player-white {
            background: white;
            color: black;
        }
        
        .player-yellow {
            background: #f1c40f;
            color: black;
        }
        
        .current-turn-container {
            display: flex;
            justify-content: center;
            margin: 15px 0;
            gap: 10px;
            align-items: stretch;
        }
        
        .current-turn-container {
            display: flex;
            justify-content: center;
            margin: 15px 0;
        }
        
        .current-turn {
            text-align: center;
            font-size: 1.2em;
            padding: 12px 25px;
            background: rgba(52, 152, 219, 0.2);
            border-radius: 10px;
            border: 2px solid #3498db;
            min-width: 300px;
        }
        /* Voor nabeurt situaties (meer inhoud) */
        .current-turn.has-extra-info {
            padding: 18px 30px;
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.2), rgba(39, 174, 96, 0.2));
            border: 3px solid #27ae60;
        }




        
        /* NIEUWE STIJLEN VOOR WIT/GEEL SCORE DISPLAYS */
        .side-score-display {
            flex: 0 0 80px;
            border-radius: 10px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .side-score-display.white {
            background: white;
            color: black;
            border: 2px solid #3182ce;
        }
        
        .side-score-display.yellow {
            background: #f1c40f;
            color: black;
            border: 2px solid #3182ce;
        }
        
        .side-score-name {
            font-size: 0.8em;
            margin-bottom: 5px;
            text-align: center;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 100%;
        }
        
        .side-score-value {
            font-size: 2em;
            font-weight: bold;
        }
        
        /* SCORE CONTROLS */
        .score-controls {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 20px 0;
            padding: 0 15px;
        }
        
        .score-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: none;
            font-size: 35px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            transition: all 0.3s;
            flex-shrink: 0;
        }
        
        .score-btn.plus-btn {
            background: #2ecc71;
            color: white;
        }
        
        .score-btn.minus-btn {
            background: #e74c3c;
            color: white;
        }
        
        .score-middle {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-grow: 1;
        }
        
        /* Zorg dat de plus knoppen niet overlappen met de score displays */
        .left-plus {
            margin-left: 5px;
        }
        
        .right-plus {
            margin-right: 5px;
        }
        
        /* NIEUWE STIJLEN VOOR CURRENT SCORE DISPLAY BOVEN SPELERKAART */
        .current-score-container {
            position: relative;
            width: 100%;
            height: 100px; /* Verkleind van 140px */
            margin-bottom: 10px;
        }
        
        .current-score-display {
            position: absolute;
            top: 0;
            width: 40%; /* Verkleind van 45% */
            padding: 15px 10px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 10;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        /* Naam bovenaan in het current-score-display */
        .current-score-name {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 5px;
            color: #2d3748;
            background: rgba(0,0,0,0.1);
            padding: 5px 15px;
            border-radius: 20px;
            width: 90%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }





        

        .current-score-display.active {
        display: flex;
        transform: scale(1.05);
        z-index: 20;
        }
        
        .current-score-display.inactive {
            display: none;
        }
        
        .current-score-display.player1-current {
            position: absolute;
            left: 0; /* Iets verder van de rand */
            background-color: white;
            border: 3px solid #3182ce;
            color: black;
        }    
    
        .current-score-display.player2-current {
            position: absolute;
            right: 0; /* Iets verder van de rand */
            background-color: #f1c40f;
            border: 3px solid #3182ce;
            color: black;
        }
        
        .current-score-label {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #2d3748;
        }
        
        .current-score-name {
        font-size: 1rem;
        font-weight: bold;
        margin-bottom: 5px;
        color: #2d3748;
        background: rgba(0,0,0,0.05);
        padding: 3px 10px;
        border-radius: 15px;
        max-width: 90%;
        overflow: hidden;
        text-overflow: ellipsis;
            white-space: nowrap;
        }
    
        .current-score-value {
            font-size: 2.5rem; /* Verkleind van 3.5rem */
            font-weight: bold;
            color: #2d3748;
        }
        
        .current-score-minus {
            position: absolute;
            bottom: -25px;
            background: #e74c3c;
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .action-btn {
            padding: 16px 30px;
            font-size: 1.2em;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: bold;
            letter-spacing: 0.5px;
        }

        .confirm-btn {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            flex-grow: 1;
            max-width: 85%;
            box-shadow: 0 4px 8px rgba(231, 76, 60, 0.3);
            transition: all 0.3s ease;
        }

        .confirm-btn:hover {
            background: linear-gradient(135deg, #c0392b, #a93226);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(231, 76, 60, 0.4);
        }

        .confirm-btn:active {
            transform: translateY(1px);
            box-shadow: 0 2px 4px rgba(231, 76, 60, 0.3);
        }

        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 5px 0 25px 0;
            padding: 0 20px;
        }

        .match-ended {
            background: #27ae60;
            color: white;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            margin: 10px;
            font-weight: bold;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-top: 8px;
            margin-bottom: 10px;
        }
        
        .stat-item {
            background: rgba(255,255,255,0.05);
            padding: 8px;
            border-radius: 5px;
            font-size: 0.85em;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        
        .stat-icon {
            font-size: 1.2em;
            margin-bottom: 3px;
        }
        
        .stat-value {
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .turns-scroll-container {
            flex-grow: 1;
            margin-top: 10px;
            overflow-y: auto;
            background: rgba(0,0,0,0.05);
            border-radius: 8px;
            padding: 8px;
            max-height: 200px;
        }
        
        .turns-list {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }
        
        .turn-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            font-size: 0.85em;
        }
        
        .turn-row:first-child {
            background: rgba(52, 152, 219, 0.2);
            font-weight: bold;
        }

        .no-matches {
            text-align: center;
            padding: 40px;
            color: #95a5a6;
        }
        
        .match-info {
            font-size: 0.85em;
            color: #bdc3c7;
            margin-top: 5px;
        }
        
        .file-upload-container {
            background: #34495e;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            text-align: center;
        }
        
        .download-btn {
            background: #2ecc71;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        
        .info-box {
            background: #3498db;
            color: white;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 0.9em;
        }
        
        .ball-selection-container {
            background: #34495e;
            border-radius: 10px;
            padding: 30px;
            margin: 20px auto;
            max-width: 500px;
            text-align: center;
        }
        
        .ball-selection-title {
            font-size: 1.3em;
            margin-bottom: 25px;
            color: #ecf0f1;
        }
        
        .ball-option {
            display: block;
            margin: 15px 0;
            cursor: pointer;
            text-align: center;
        }
        
        .ball-circle {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: bold;
            margin: 0 auto 10px;
            border: 4px solid transparent;
            transition: all 0.3s;
        }
        
        .ball-circle.white {
            background: white;
            color: black;
        }
        
        .ball-circle.yellow {
            background: #f1c40f;
            color: black;
        }
        
        .ball-circle.selected {
            border-color: #e74c3c;
            box-shadow: 0 0 15px rgba(231, 76, 60, 0.7);
            transform: scale(1.1);
        }
        
        .ball-option-label {
            font-size: 1em;
            margin-top: 5px;
        }
        
        .start-match-btn {
            background: #2ecc71;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            margin-top: 30px;
        }
        
        .disabled-btn {
            background: #7f8c8d;
            cursor: not-allowed;
        }
        
        .selection-container {
            background: #34495e;
            border-radius: 10px;
            padding: 30px;
            margin: 20px auto;
            max-width: 600px;
            text-align: center;
        }
        
        .selection-title {
            font-size: 1.4em;
            margin-bottom: 30px;
            color: #ecf0f1;
        }
        
        .date-input {
            width: 100%;
            padding: 15px;
            font-size: 1.1em;
            border-radius: 8px;
            border: 2px solid #3498db;
            background: #2c3e50;
            color: white;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .next-btn {
            background: #2ecc71;
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            margin-top: 20px;
        }
        
        .header-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .matches-list-container {
            margin-top: 20px;
        }
        
        .matches-list-title {
            font-size: 1.2em;
            margin-bottom: 15px;
            color: #ecf0f1;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
        }
        
        .status-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .status-pending {
            background: #f39c12;
            color: white;
        }
        
        .status-completed {
            background: #27ae60;
            color: white;
        }
        
        .status-downloaded {
            background: #3498db;
            color: white;
        }
        
        .clear-all-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px 0;
            font-size: 14px;
        }
        
        .match-stats {
            font-size: 0.8em;
            color: #95a5a6;
            margin-top: 5px;
        }
        
        .download-section {
            background: #2c3e50;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid #2ecc71;
        }
        
        .download-section h3 {
            color: #2ecc71;
            margin-bottom: 15px;
        }
        
        .player-selection-container {
            background: #34495e;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }
        
        .player-selection-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }
        
        .player-select-box {
            background: #2c3e50;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .player-select-box:hover {
            background: #3c4e60;
            transform: translateY(-2px);
        }
        
        .player-select-box.selected {
            background: #3498db;
            border-color: #2980b9;
        }
        
        .player-select-box h3 {
            margin: 0 0 10px 0;
            font-size: 1.1em;
        }
        
        .player-select-box p {
            margin: 5px 0;
            font-size: 0.9em;
            color: #bdc3c7;
        }
        
        .target-input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            border: 2px solid #3498db;
            background: #2c3e50;
            color: white;
            font-size: 1.1em;
            text-align: center;
        }
        
        .create-match-btn {
            background: #2ecc71;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            margin-top: 20px;
            width: 100%;
        }
        
        .create-match-btn:disabled {
            background: #7f8c8d;
            cursor: not-allowed;
        }
        
        .action-btn-small {
            padding: 6px 12px;
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
        }
        
        .action-btn-small:hover {
            opacity: 0.8;
            transform: scale(1.05);
        }
        
        .matches-tabs {
            display: flex;
            border-bottom: 2px solid #34495e;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 12px 24px;
            background: #2c3e50;
            border: none;
            color: #ecf0f1;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
            border-radius: 8px 8px 0 0;
            margin-right: 5px;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tab-btn:hover {
            background: #34495e;
        }
        
        .tab-btn.active {
            background: #3498db;
            color: white;
            font-weight: bold;
        }
        
        .tab-btn .badge {
            background: rgba(255,255,255,0.2);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8em;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .match-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .new-match-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 20px auto;
            display: block;
        }
        
        /* NIEUW: Dynamische "nog nodig" display */
        .dynamic-needed {
            position: absolute;
            top: -25px;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            font-size: 1.1em;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            z-index: 10;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* ========== SPELERS BEHEER STIJLEN ========== */
        .players-management-container {
            padding: 20px;
        }
        
        .player-form-container {
            background: #34495e;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            border-left: 4px solid #3498db;
        }
        
        .player-form-container h3 {
            color: #3498db;
            margin-bottom: 20px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr auto;
            gap: 15px;
            margin-bottom: 15px;
            align-items: end;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            margin-bottom: 8px;
            color: #bdc3c7;
            font-size: 0.9em;
        }
        
        .form-input {
            padding: 12px;
            border-radius: 6px;
            border: 2px solid #3498db;
            background: #2c3e50;
            color: white;
            font-size: 16px;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #2ecc71;
        }
        
        .add-player-btn {
            background: #2ecc71;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            height: 44px;
            transition: all 0.3s;
        }
        
        .add-player-btn:hover {
            background: #27ae60;
            transform: translateY(-2px);
        }
        
        .players-list-container {
            background: #34495e;
            border-radius: 10px;
            padding: 20px;
        }
        
        .players-list-header {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr auto;
            gap: 15px;
            padding: 15px;
            background: #2c3e50;
            border-radius: 8px;
            margin-bottom: 10px;
            font-weight: bold;
            color: #3498db;
        }
        
        .player-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr auto;
            gap: 15px;
            padding: 15px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            margin-bottom: 10px;
            align-items: center;
            transition: all 0.3s;
        }
        
        .player-row:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .player-row.editing {
            background: rgba(52, 152, 219, 0.1);
            border: 2px solid #3498db;
        }
        
        .player-actions {
            display: flex;
            gap: 10px;
        }
        
        .edit-btn, .save-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .delete-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .cancel-btn {
            background: #7f8c8d;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .import-export-container {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .import-export-btn {
            background: #9b59b6;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 15px;
        }
        
        .bulk-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .bulk-action-btn {
            background: #34495e;
            color: white;
            border: 2px solid #3498db;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .bulk-action-btn:hover {
            background: #3498db;
        }
        
        .player-search {
            margin-bottom: 20px;
        }
        
        .search-input {
            width: 100%;
            padding: 12px;
            border-radius: 6px;
            border: 2px solid #2ecc71;
            background: #2c3e50;
            color: white;
            font-size: 16px;
        }
        
        .stats-summary {
            background: #2c3e50;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            color: #bdc3c7;
        }
        
        .stats-item {
            text-align: center;
        }
        
        .stats-value {
            font-size: 1.5em;
            color: #2ecc71;
            font-weight: bold;
        }
        
        .empty-players-message {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
            font-size: 1.1em;
        }
        
        .editable-input {
            background: transparent;
            border: 2px solid #3498db;
            color: white;
            padding: 8px;
            border-radius: 4px;
            width: 100%;
        }
        
        .editable-input:focus {
            outline: none;
            border-color: #2ecc71;
        }



	/* Stats & Ranking Stijlen */
	/* ==================== STATS & RANKING STYLES ==================== */

	.players-stats-grid {
	    display: grid;
	    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
	    gap: 20px;
	    padding: 20px 0;
	}
	.player-stats-card {
	    background: #34495e;
	    border-radius: 12px;
	    padding: 20px;
	    border-left: 5px solid #3498db;
	    transition: transform 0.3s;
	}
	
	.player-stats-card:hover {
	    transform: translateY(-5px);
	    box-shadow: 0 10px 20px rgba(0,0,0,0.2);
	}
	
	.player-stats-card h3 {
	    margin: 0 0 15px 0;
	    color: #ecf0f1;
	    font-size: 1.3em;
	}
	
	.detail-btn {
	    background: #3498db;
	    color: white;
	    border: none;
	    padding: 10px 15px;
	    border-radius: 6px;
	    cursor: pointer;
	    width: 100%;
	    margin-bottom: 15px;
	    font-size: 0.9em;
	}
	
	.detail-btn:hover {
	    background: #2980b9;
	}
	
	.stats-summary {
	    display: grid;
	    grid-template-columns: 1fr 1fr;
	    gap: 10px;
	    font-size: 0.9em;
	}
	
	.stats-summary p {
	    margin: 5px 0;
	    color: #bdc3c7;
	}
	
	/* Ranking Table */
	.ranking-container {
	    overflow-x: auto;
	    margin-top: 20px;
	}
	
	.ranking-table {
	    width: 100%;
	    border-collapse: collapse;
	    background: #34495e;
	    border-radius: 10px;
	    overflow: hidden;
	}
	
	.ranking-table th {
	    background: #2c3e50;
	    color: #3498db;
	    padding: 15px;
	    text-align: left;
	    font-weight: bold;
	}
	
	.ranking-table td {
	    padding: 12px 15px;
	    border-bottom: 1px solid #2c3e50;
	}
	
	.ranking-table tr:last-child td {
	    border-bottom: none;
	}
	
	.ranking-table tr:hover {
	    background: #3b5998;
	}
	
	.ranking-table .top-player {
	    background: rgba(52, 152, 219, 0.1);
	}
	
	.ranking-table .top-player td:first-child {
	    font-weight: bold;
	    color: #f1c40f;
	}
	
	/* Player Detail */
	.player-detail {
	    padding: 20px;
	}
	
	.back-btn {
	    background: #7f8c8d;
	    color: white;
	    border: none;
	    padding: 10px 20px;
	    border-radius: 6px;
	    cursor: pointer;
	    margin-bottom: 20px;
	}
	
	.stats-grid {
	    display: grid;
	    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
	    gap: 15px;
	    margin: 20px 0;
	}
	
	.stat-box {
	    background: #34495e;
	    border-radius: 10px;
	    padding: 20px;
	    text-align: center;
	    border-top: 4px solid #3498db;
	}
	
	.stat-box h3 {
	    font-size: 2em;
	    margin: 0;
	    color: #ecf0f1;
	}
	
	.stat-box p {
	    margin: 10px 0 0 0;
	    color: #bdc3c7;
	    font-size: 0.9em;
	}
	
	.match-history {
	    margin-top: 30px;
	}
	
	.match-history-item {
	    display: grid;
	    grid-template-columns: 2fr 2fr 1fr 1fr;
	    gap: 15px;
	    padding: 15px;
	    background: #34495e;
	    margin-bottom: 10px;
	    border-radius: 8px;
	    align-items: center;
	}
	
	.match-history-item.win {
	    border-left: 4px solid #2ecc71;
	}
	
	.match-history-item.loss {
	    border-left: 4px solid #e74c3c;
	}
	
	.match-history-item .result {
	    font-weight: bold;
	    padding: 5px 10px;
	    border-radius: 4px;
	    text-align: center;
	}
	
	.match-history-item.win .result {
	    background: rgba(46, 204, 113, 0.2);
	    color: #2ecc71;
	}
	
	.match-history-item.loss .result {
	    background: rgba(231, 76, 60, 0.2);
	    color: #e74c3c;
	}
	
	/* Messages */
	.no-data-message, .error-message {
	    text-align: center;
	    padding: 40px 20px;
	    background: #34495e;
	    border-radius: 10px;
	    margin: 20px 0;
	}
	
	.no-data-message h3, .error-message h3 {
	    color: #f1c40f;
	}
	
	/* Responsive */
	@media (max-width: 768px) {
	    .players-stats-grid {
	        grid-template-columns: 1fr;
	    }
	    
	    .match-history-item {
	        grid-template-columns: 1fr;
	        gap: 5px;
	    }
    
	    .stats-grid {
	        grid-template-columns: repeat(2, 1fr);
	    }
	}



/* ==================== EXCEL SPECIFIEKE STIJLEN ==================== */

/* Excel Card Styling */
.excel-stats-card {
    border-left: 5px solid #3498db;
    position: relative;
}

.card-header-excel {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.match-count-badge {
    background: #3498db;
    color: white;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 0.8em;
    font-weight: bold;
}

.excel-detail-btn {
    background: linear-gradient(135deg, #3498db, #2980b9);
    margin-bottom: 15px;
}

.excel-summary {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    font-size: 0.9em;
    margin-bottom: 15px;
}

.excel-target-box {
    background: rgba(52, 152, 219, 0.1);
    border: 2px solid #3498db;
    border-radius: 8px;
    padding: 10px;
    margin-top: 10px;
    text-align: center;
}

.excel-target-box.target-achieved {
    background: rgba(46, 204, 113, 0.1);
    border-color: #2ecc71;
}

.excel-target-box.target-pending {
    background: rgba(241, 196, 15, 0.1);
    border-color: #f1c40f;
}

.target-label {
    display: block;
    font-weight: bold;
    color: #3498db;
    margin-bottom: 5px;
}

.target-value {
    font-size: 1.5em;
    font-weight: bold;
    color: #2c3e50;
}

.target-success, .target-warning {
    display: block;
    font-size: 0.8em;
    margin-top: 5px;
}

.target-success {
    color: #27ae60;
}

.target-warning {
    color: #e67e22;
}

/* Excel Ranking Table */
.excel-ranking-table th {
    background: #2c3e50;
    color: #3498db;
    font-size: 0.9em;
    padding: 12px 8px;
}

.excel-ranking-table td {
    padding: 10px 8px;
    font-size: 0.9em;
}

.rank-position {
    font-weight: bold;
    color: #f1c40f;
}

.rank-score {
    font-weight: bold;
    color: #2ecc71;
}

.rank-target {
    color: #3498db;
    font-weight: bold;
}

.rank-average {
    color: #9b59b6;
}

.status-qualified {
    color: #27ae60;
}

.status-pending {
    color: #e67e22;
}

.excel-top-player {
    background: rgba(241, 196, 15, 0.15) !important;
}

.excel-top-player td:first-child {
    font-weight: bold;
    color: #f1c40f !important;
}

.ranking-legend {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-top: 20px;
    flex-wrap: wrap;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.9em;
    color: #bdc3c7;
}

.legend-color {
    width: 15px;
    height: 15px;
    border-radius: 3px;
}

.legend-color.gold {
    background: rgba(241, 196, 15, 0.3);
    border: 1px solid #f1c40f;
}

.legend-color.qualified {
    background: rgba(46, 204, 113, 0.3);
    border: 1px solid #2ecc71;
}

.legend-color.pending {
    background: rgba(230, 126, 34, 0.3);
    border: 1px solid #e67e22;
}

/* Excel Detail View */
.excel-detail-view .detail-header {
    margin-bottom: 25px;
}

.ref-values {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    background: rgba(52, 152, 219, 0.1);
    padding: 15px;
    border-radius: 8px;
    margin-top: 15px;
}

.ref-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.ref-label {
    font-weight: bold;
    color: #3498db;
    font-size: 0.9em;
}

.ref-value {
    background: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-weight: bold;
    color: #2c3e50;
}

.excel-stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 15px;
    margin: 25px 0;
}

.target-stat-box {
    border-top: 4px solid #3498db;
}

.target-stat-box.target-achieved {
    border-top-color: #2ecc71;
}

.target-stat-box.target-pending {
    border-top-color: #f1c40f;
}

/* ==================== EXCEL TABEL STIJLEN ==================== */
/* ==================== EXCEL TABEL STIJLEN - COMPLEET GEWIJZIGD ==================== */
/* Hoofd container */
.excel-table-container {
    margin: 20px 0;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    background: white;
}

/* Bovenste header met titel en knop */
.table-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #2c3e50;
    padding: 15px 20px;
    border-top-left-radius: 8px;
    border-top-right-radius: 8px;
}

.table-header h3 {
    margin: 0;
    color: #ecf0f1;
    font-family: 'Cavolini', Arial, sans-serif;
}

.small-btn {
    padding: 8px 15px;
    font-size: 0.9em;
    background: #3498db;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

/* Tabel wrapper voor horizontaal scrollen */
.table-wrapper {
    overflow-x: auto;
}

/* BASIS TABEL STIJL */
.excel-table {
    width: 100%;
    border-collapse: collapse;
    min-width: 1200px;
}

/* ========== EERSTE RIJ (speler header) - LICHTBLAUW ========== */
.excel-table .excel-header tr:first-child th {
    background: #d9e1f2 !important; /* Lichtblauw achtergrond voor ALLE cellen */
    font-weight: bold;
    font-size: 12px;
    padding: 10px 4px;
    border: 1px solid #44546a;
    text-align: center;
    font-family: 'Cavolini', 'Segoe UI', Arial, sans-serif;
    /* GEEN algemene color regel hier! Laat individuele klassen bepalen */
}

/* Spelernaam (eerste 3 cellen) - RODE TEKST */
.excel-table .excel-header tr:first-child th:first-child {
    color: #ff0000 !important; /* Rode tekst voor spelernaam */
}

/* "1,00" en "20" - RODE TEKST (EERST deze regel) */
.excel-table .excel-header tr:first-child th.red-text {
    color: #ff0000 !important; /* Rood */
    font-weight: bold;
}

/* "Gemiddelde", "Te maken punten", "Behaalde matchpunten" - ZWARTE TEKST (DAARNA deze) */
.excel-table .excel-header tr:first-child th.header-text-black {
    color: #000000 !important; /* Zwarte tekst */
    font-weight: bold;
}

/* Bruine cellen voor referentiewaarden (TargetEersteZes en TSGEersteZes) */
.excel-table .excel-header tr:first-child th.beige-bg {
    background: #f4dbbc !important; /* Lichtbruin voor G1 en K1 */
    color: #000000 !important;
    font-family: 'Cavolini', 'Segoe UI', Arial, sans-serif;
}

/* ========== TWEEDE RIJ (kolomkoppen) - LICHTBLAUW ========== */
.excel-subheader {
    background: #d9e1f2 !important; /* Lichtblauw */
    font-family: 'Cavolini', 'Segoe UI', Arial, sans-serif;
}

.excel-subheader th {
    padding: 8px 4px;
    text-align: center;
    font-weight: bold;
    border: 1px solid #44546a; /* Donkere rand */
    color: #000000 !important; /* Zwarte tekst */
    font-size: 11px;
    font-family: 'Cavolini', 'Segoe UI', Arial, sans-serif;
}

/* Kolom P: "Behaalde matchpunten" (heeft rijspan 2) - ZWARTE TEKST */
.excel-table th[colspan="1"][rowspan="2"] {
    background: #d9e1f2 !important; /* Lichtblauw */
    color: #000000 !important; /* Zwarte tekst */
    font-weight: bold;
    border: 1px solid #44546a;
    vertical-align: middle;
    font-family: 'Cavolini', 'Segoe UI', Arial, sans-serif;
}

/* ========== DATA RIJEN - CALIBRI FONT ========== */
.excel-cell {
    padding: 6px 4px;
    border: 1px solid #ddd;
    text-align: center;
    color: #000000; /* Zwarte tekst standaard */
    font-family: 'Calibri', 'Segoe UI', Arial, sans-serif !important; /* Calibri voor cijfers */
}

/* Afwisselende rij kleuren */
.excel-even {
    background: #ffffff; /* Wit */
}

.excel-odd {
    background: #f9f9f9; /* Licht grijs */
}

/* Nummer cellen (monospace font voor cijfers) */
.excel-cell.number {
    font-family: 'Calibri', 'Courier New', monospace !important;
    font-weight: bold;
}

/* Percentage cellen */
.excel-cell.percentage {
    font-weight: bold;
}

/* Gewonnen vs Verloren matches */
.excel-won {
    background: rgba(46, 204, 113, 0.2) !important; /* Groene achtergrond */
}

.excel-lost {
    background: rgba(231, 76, 60, 0.1) !important; /* Rode achtergrond */
}

/* ========== TOTAAL RIJ (eerste samenvattingsrij) ========== */
.excel-summary-1 {
    background: #d9e1f2 !important; /* Lichtblauw achtergrond */
    font-weight: bold;
    font-size: 13px; /* Iets groter font */
    padding: 12px 4px !important; /* Meer padding voor hogere rij */
    font-family: 'Cavolini', 'Segoe UI', Arial, sans-serif !important;
    border-top: 2px solid #44546a !important; /* DIKKERE bovenrand */
    height: 40px !important; /* Expliciete hoogte */
}

.excel-summary-1 td {
    padding: 12px 4px !important; /* Meer hoogte */
    border: 1px solid #44546a;
    font-size: 13px;
    font-family: 'Cavolini', 'Segoe UI', Arial, sans-serif !important;
    font-weight: bold;
    color: #000000 !important; /* Zwarte tekst */
}

/* Samenvatting labels (links uitgelijnd) */
.summary-label {
    font-weight: bold;
    text-align: left !important;
    padding-left: 10px !important;
    color: #000000 !important; /* Zwart */
    font-family: 'Cavolini', 'Segoe UI', Arial, sans-serif !important;
}

.summary-value {
    font-weight: bold;
    color: #000000 !important; /* Zwart */
    font-family: 'Cavolini', 'Segoe UI', Arial, sans-serif !important;
}

.summary-dash {
    color: #000000 !important; /* Zwart */
    font-weight: bold;
    font-family: 'Cavolini', 'Segoe UI', Arial, sans-serif !important;
}

/* ========== TE MAKEN PUNTEN RIJ (tweede samenvattingsrij) ========== */
.excel-summary-2 {
    background: #fff9c4 !important; /* Licht geel voor achtergrond */
    font-weight: bold;
    font-family: 'Cavolini', 'Segoe UI', Arial, sans-serif !important;
}

.excel-summary-2 td {
    font-family: 'Cavolini', 'Segoe UI', Arial, sans-serif !important;
    font-weight: bold;
    border: 1px solid #44546a;
}

/* "Te maken punten volgend seizoen ..." - RODE TEKST, ENKEL STANDAARD RAND */
.target-label {
    text-align: center !important; /* Horizontaal gecentreerd */
    vertical-align: middle !important; /* Verticaal gecentreerd */
    padding: 10px 4px !important;
    font-weight: bold;
    color: #ff0000 !important; /* RODE TEKST */
    font-family: 'Cavolini', 'Segoe UI', Arial, sans-serif !important;
    background: #fff9c4 !important; /* Lichtgele achtergrond zoals rest van rij */
    border: 1px solid #44546a !important; /* ENKEL deze standaard rand */
    /* Verwijder alle extra border properties: */
    border-left: 1px solid #44546a !important;
    border-right: 1px solid #44546a !important;
    border-top: 1px solid #44546a !important;
    border-bottom: 1px solid #44546a !important;
}

/* Target berekening cel (K kolom) - GRIJZE ACHTERGROND */
.target-calc {
    background: #d3d3d3 !important; /* Grijze achtergrond */
    color: #e74c3c !important; /* Rode tekst */
    font-weight: bold;
    text-align: center !important;
    vertical-align: middle !important;
    padding: 10px 4px !important;
    font-family: 'Cavolini', 'Segoe UI', Arial, sans-serif !important;
    border: 1px solid #44546a !important;
}

/* Eindresultaat cel (L kolom) - GRIJZE ACHTERGROND */
.target-final {
    background: #d3d3d3 !important; /* Grijze achtergrond */
    color: #27ae60 !important; /* Groene tekst */
    font-weight: bold;
    font-size: 13px;
    text-align: center !important;
    vertical-align: middle !important;
    padding: 10px 4px !important;
    font-family: 'Cavolini', 'Segoe UI', Arial, sans-serif !important;
    border: 1px solid #44546a !important;
}

/* Waarschuwingscel */
.warning-text {
    text-align: center !important;
    color: #e74c3c !important; /* Rood */
    font-weight: bold;
    padding: 10px !important;
    font-family: 'Cavolini', 'Segoe UI', Arial, sans-serif !important;
    border: 1px solid #44546a !important;
}

/* ========== SPECIFIEKE KLEUREN VOOR PERCENTAGES ========== */
/* POSITIEF (groen) */
.percentage-positive {
    color: #27ae60 !important; /* Groen */
    font-weight: bold;
}

/* NEGATIEF (rood) */
.percentage-negative {
    color: #e74c3c !important; /* Rood */
    font-weight: bold;
}

/* NEUTRAAL (grijs) */
.percentage-neutral {
    color: #7f8c8d !important; /* Grijs */
}

/* ========== RESPONSIVE ========== */
@media (max-width: 768px) {
    .excel-table {
        font-size: 11px;
        min-width: 1000px;
    }
    
    .excel-subheader th {
        font-size: 10px;
        padding: 6px 2px;
    }
    
    .excel-cell {
        padding: 4px 2px;
    }
    
    .excel-summary-1 td,
    .excel-summary-2 td {
        padding: 8px 2px !important;
        font-size: 11px;
    }
    
    .target-label,
    .target-calc,
    .target-final {
        padding: 8px 2px !important;
    }
}

/* ==================== EXCEL KLASSEMENT STIJL (VBA MACRO) ==================== */

/* Hoofd container voor klassement */
.excel-klassement-container {
    margin: 20px 0;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    background: white;
}

/* Klassement titel - COMIC SANS MS */
.klassement-title {
    background: #4472c4; /* Excel accent5 kleur */
    padding: 20px;
    text-align: center;
    border-bottom: 2px solid #44546a;
}

.klassement-title h1 {
    margin: 0;
    font-family: 'Comic Sans MS', cursive, sans-serif !important;
    font-size: 24px !important;
    color: #0078d4 !important; /* Excel blauw: -16776961 = #0078d4 */
    font-weight: normal;
}

/* Tabel wrapper voor horizontaal scrollen */
.klassement-wrapper {
    overflow-x: auto;
}

/* BASIS KLASSEMENT TABEL - EXCEL STIJL */
.klassement-table {
    width: 100%;
    border-collapse: collapse;
    min-width: 1200px;
    font-family: 'Calibri', 'Segoe UI', Arial, sans-serif;
}

/* ========== KOPTEKST RIJEN ========== */

/* EERSTE RIJ (titelrij) */
.klassement-table tr:nth-child(1) {
    background: #4472c4 !important; /* accent6 met tint 0.799981688894314 */
    height: 37.5px !important;
}

/* TWEEDE RIJ (Naam + speeldagnummers) */
.klassement-table tr:nth-child(2) th {
    background: #4472c4 !important; /* accent6 met tint 0.799981688894314 */
    color: white;
    font-weight: bold;
    text-align: center;
    border: 1px solid #44546a;
    font-size: 12px;
}

/* "Naam" cel in rij 2-3 gespannen */
.klassement-table tr:nth-child(2) th.naam-header {
    text-align: center;
    vertical-align: bottom;
    background: #4472c4 !important; /* accent6 met tint 0.799981688894314 */
}

/* DERDE RIJ (datums + "totaal" kolommen) */
.klassement-table tr:nth-child(3) th {
    background: #4472c4 !important; /* accent6 met tint 0.799981688894314 */
    color: white;
    text-align: center;
    border: 1px solid #44546a;
    font-size: 11px;
    padding: 4px 2px;
}

/* Datum cellen (d-mmm formaat) */
.klassement-table tr:nth-child(3) th.datum-header {
    background: #4472c4 !important;
    color: white;
    text-align: center;
    font-size: 11px;
    border: 1px solid #44546a;
}

/* "totaal" kolommen VERTICAAL geschreven */
.klassement-table tr:nth-child(3) th.totaal-column {
    writing-mode: vertical-lr;
    transform: rotate(180deg);
    text-align: center;
    vertical-align: middle;
    width: 24px !important; /* 2.4 kolombreedte in Excel */
    background: #4472c4 !important;
    color: #0078d4 !important; /* accent5 kleur */
    font-weight: bold;
    border: 1px solid #44546a;
}

/* Laatste "totaal" kolom (eindtotaal) - SPECIAAL */
.klassement-table tr:nth-child(3) th.final-total-column {
    writing-mode: vertical-lr;
    transform: rotate(180deg);
    text-align: center;
    vertical-align: middle;
    width: 33px !important; /* 3.29 kolombreedte in Excel */
    background: #4472c4 !important;
    color: #0078d4 !important; /* accent5 kleur */
    font-weight: bold;
    border: 1px solid #44546a;
}

/* ========== DATA RIJEN (SPELERS) ========== */

/* Speler naam kolom */
.klassement-table td.speler-naam {
    font-weight: bold;
    text-align: left;
    padding: 8px 4px;
    border: 1px solid #44546a;
    background: white;
    min-width: 140px; /* 18.86 kolombreedte in Excel */
}

/* Matchpunten cellen (2 kolommen per speeldag) */
.klassement-table td.match-punt {
    text-align: center;
    padding: 8px 2px;
    border: 1px solid #44546a;
    font-weight: bold;
    min-width: 25px; /* 3.29 kolombreedte in Excel */
    background: white;
}

/* Tussentotaal cellen (na elke speeldag) */
.klassement-table td.tussentotaal {
    text-align: center;
    padding: 8px 2px;
    border: 1px solid #44546a;
    font-weight: bold;
    background: #f4dbbc !important; /* accent2 met tint 0.599993896298105 */
    color: #0078d4 !important; /* accent1 kleur */
    min-width: 20px; /* 2.4 kolombreedte in Excel */
    font-size: 13px;
}

/* Eindtotaal cel (laatste kolom) */
.klassement-table td.eindtotaal {
    text-align: center;
    padding: 8px 4px;
    border: 1px solid #44546a;
    font-weight: bold;
    font-size: 14px;
    color: #0078d4 !important; /* Excel blauw */
    background: #f4dbbc !important; /* accent4 met tint 0.799981688894314 */
    min-width: 33px; /* 3.29 kolombreedte in Excel */
}

/* ========== KLEUREN OM DE 6 KOLOMMEN (GELE ACHTERGROND) ========== */

/* Om de 6 kolommen (vanaf kolom C): gele achtergrond */
.klassement-table tr:nth-child(n+4) td:nth-child(3n+3),
.klassement-table tr:nth-child(n+4) td:nth-child(3n+4),
.klassement-table tr:nth-child(n+4) td:nth-child(3n+5) {
    background: #f4dbbc !important; /* accent4 met tint 0.799981688894314 */
}

/* Laatste kolom (eindtotaal) overschrijven met speciale stijl */
.klassement-table tr:nth-child(n+4) td.eindtotaal {
    background: #f4dbbc !important;
    color: #0078d4 !important;
}

/* ========== BEREKENDE FORMULES (CSS PSEUDO-ELEMENTEN) ========== */

/* Voor tussentotalen - toon som icoon */
.klassement-table td.tussentotaal::before {
    content: "";
    font-size: 10px;
    color: #666;
    margin-right: 2px;
}

/* Voor eindtotaal - toon som icoon */
.klassement-table td.eindtotaal::before {
    content: "";
    font-size: 12px;
    color: #0078d4;
    margin-right: 4px;
    font-weight: bold;
}

/* ========== SPECIALE STIJLEN VOOR SORTERING ========== */

/* Sorteerbaar bij hover */
.klassement-table th.sortable {
    cursor: pointer;
    position: relative;
}

.klassement-table th.sortable:hover {
    background: #5b9bd5 !important;
}

/* Sorteer pijlen */
.klassement-table th.sortable.asc::after {
    content: " ";
    font-size: 10px;
    color: white;
}

.klassement-table th.sortable.desc::after {
    content: " ";
    font-size: 10px;
    color: white;
}

/* ========== RANDEN ========== */
.klassement-table th,
.klassement-table td {
    border: 1px solid #44546a !important;
}

/* Dikkere randen voor kopteksten */
.klassement-table tr:nth-child(1) th,
.klassement-table tr:nth-child(2) th,
.klassement-table tr:nth-child(3) th {
    border-width: 1px !important;
    border-style: solid !important;
    border-color: #44546a !important;
}

/* ========== RESPONSIVE ========== */
@media (max-width: 768px) {
    .klassement-table {
        font-size: 11px;
        min-width: 800px;
    }
    
    .klassement-title h1 {
        font-size: 18px !important;
        padding: 10px;
    }
    
    .klassement-table td.speler-naam {
        min-width: 120px;
        font-size: 12px;
    }
    
    .klassement-table td.match-punt,
    .klassement-table td.tussentotaal,
    .klassement-table td.eindtotaal {
        min-width: 20px;
        padding: 4px 1px;
        font-size: 11px;
    }
}

/* ========== PRINT STIJLEN ========== */
@media print {
    .klassement-container {
        box-shadow: none;
        margin: 0;
    }
    
    .klassement-table {
        min-width: auto;
        width: 100%;
    }
    
    .klassement-title {
        background: white !important;
        -webkit-print-color-adjust: exact;
        color-adjust: exact;
    }
    
    .klassement-title h1 {
        color: black !important;
        -webkit-print-color-adjust: exact;
        color-adjust: exact;
    }
    
    .klassement-table th,
    .klassement-table td {
        background: white !important;
        -webkit-print-color-adjust: exact;
        color-adjust: exact;
        border-color: black !important;
    }
    
    /* Behoud gele achtergrond bij print */
    .klassement-table tr:nth-child(n+4) td:nth-child(3n+3),
    .klassement-table tr:nth-child(n+4) td:nth-child(3n+4),
    .klassement-table tr:nth-child(n+4) td:nth-child(3n+5),
    .klassement-table td.eindtotaal {
        background: #fff2cc !important; /* Lichtgeel voor print */
        -webkit-print-color-adjust: exact;
        color-adjust: exact;
    }
}

/* ========== NIEUWE STIJLEN VOOR SPEELDAGEN BEHEER ========== */
.speeldagen-management-container {
    padding: 20px;
}

.speeldagen-form-container {
    background: #34495e;
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 30px;
    border-left: 4px solid #e67e22;
}

.speeldagen-form-container h3 {
    color: #e67e22;
    margin-bottom: 20px;
}

.speeldagen-list-container {
    background: #34495e;
    border-radius: 10px;
    padding: 20px;
    margin-top: 20px;
}

.speeldagen-list-header {
    display: grid;
    grid-template-columns: 1fr 2fr 1fr auto;
    gap: 15px;
    padding: 15px;
    background: #2c3e50;
    border-radius: 8px;
    margin-bottom: 10px;
    font-weight: bold;
    color: #e67e22;
}

.speeldag-row {
    display: grid;
    grid-template-columns: 1fr 2fr 1fr auto;
    gap: 15px;
    padding: 15px;
    background: rgba(255,255,255,0.05);
    border-radius: 8px;
    margin-bottom: 10px;
    align-items: center;
    transition: all 0.3s;
}

.speeldag-row:hover {
    background: rgba(255,255,255,0.1);
}

.speeldag-actions {
    display: flex;
    gap: 10px;
}

.empty-speeldagen-message {
    text-align: center;
    padding: 40px;
    color: #7f8c8d;
    font-size: 1.1em;
}

.date-full-format {
    font-weight: bold;
    color: #ecf0f1;
}

.speeldag-volgnummer {
    background: #e67e22;
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-weight: bold;
    display: inline-block;
    min-width: 30px;
    text-align: center;
}

/* ========== SPEELDAGEN TABBLAD ========== */
.tab-btn.speeldagen {
    background: #2c3e50;
}

.tab-btn.speeldagen.active {
    background: #e67e22;
}

.tab-btn.speeldagen:hover {
    background: #d35400;
}

    </style>
</head>
<body id="bodyElement">
    <!-- LOGIN PAGE -->
    <div id="loginPage">
        <div class="login-container">
            <h1> Biljart Score App</h1>
            <p>Voer clubwachtwoord in:</p>
            
            <input type="password" id="passwordInput" class="password-input" 
                   placeholder="Wachtwoord" autofocus>
            
            <button onclick="checkPassword()" class="login-btn">
                 Toegang tot App
            </button>
            
            <div id="errorMessage" class="error-message">
                 Onjuist wachtwoord. Probeer opnieuw.
            </div>
            
            <div class="app-info">
                <p>Biljartclub Sport & Vermaak 2.0</p>
                <p>Alleen voor geautoriseerde gebruikers</p>
            </div>
        </div>
    </div>
    
    <!-- APP CONTAINER -->
    <div id="appContainer">
        <!-- PAGINA 1: Start (Datum selectie) -->
        <div id="page1" class="page active">
            <div class="header">
                <h1> Biljartclub Sport & Vermaak 2.0</h1>
                <div class="header-buttons">
                    <button class="download-btn" onclick="checkAdminPassword()"> Beheer Matchen</button>
                </div>
            </div>
        
            <div class="selection-container">
                <div class="selection-title">Selecteer Datum</div>
                <input type="date" id="dateSelect" class="date-input">
                <button class="next-btn" onclick="goToPage2()">Maak match of kies een match uit de lijst </button>
            </div>
	    <!-- In je bestaande homepagina, ergens waar knoppen staan -->
	    <button onclick="showPage(8)" style="font-size:1.2rem; padding:14px 24px;">
     Statistieken
</button>
<button onclick="showPage(9)" style="font-size:1.2rem; padding:14px 24px;">
     Rangschikking
</button>
        </div>
        
        <!-- PAGINA 2: Match selectie -->
        <div id="page2" class="page">
            <div class="header">
                <div>
                    <button class="home-btn" onclick="showPage(1)"> Hoofdmenu</button>
                    <button class="back-btn" onclick="showPage(1)"> Terug</button>
                </div>
                <h1 id="matchListTitle">Matchen</h1>
                <div style="display: flex; gap: 10px;">
                    <button class="new-match-btn" onclick="createNewMatch()"> Nieuwe Match</button>
                </div>
            </div>
            
            <div id="matchList"></div>
        </div>
        
        <!-- PAGINA 3: Nieuwe match aanmaken -->
        <div id="page3" class="page">
            <div class="header">
                <div>
                    <button class="home-btn" onclick="showPage(1)"> Hoofdmenu</button>
                    <button class="back-btn" onclick="showPage(2)"> Terug</button>
                </div>
                <h1 id="newMatchTitle">Nieuwe Match Aanmaken</h1>
                <div style="width: 70px;"></div>
            </div>
            
            <div class="selection-container">
                <div class="selection-title" id="newMatchInfo"></div>
                
                <div class="player-selection-container">
                    <div class="player-selection-grid">
                        <div class="player-select-box" id="player1Box" onclick="selectPlayerForNewMatch(1)">
                            <h3>Speler 1</h3>
                            <p id="player1Name">Niet geselecteerd</p>
                            <p id="player1Details">Klik om speler te selecteren</p>
                            <input type="number" id="player1Target" class="target-input" placeholder="Target punten" min="1" max="200" onchange="validateTargets()">
                        </div>
                        
                        <div class="player-select-box" id="player2Box" onclick="selectPlayerForNewMatch(2)">
                            <h3>Speler 2</h3>
                            <p id="player2Name">Niet geselecteerd</p>
                            <p id="player2Details">Klik om speler te selecteren</p>
                            <input type="number" id="player2Target" class="target-input" placeholder="Target punten" min="1" max="200" onchange="validateTargets()">
                        </div>
                    </div>
                    
                    <div id="availablePlayers" style="margin-top: 20px; max-height: 300px; overflow-y: auto; background: #2c3e50; border-radius: 8px; padding: 15px;">
                        <!-- Hier komen de beschikbare spelers -->
                    </div>
                    
                    <button id="createMatchBtn" class="create-match-btn" onclick="createManualMatch()" disabled>
                         Match Aanmaken
                    </button>
                </div>
            </div>
        </div>
        
        <!-- PAGINA 4: Bal kleur selectie -->
        <div id="page4" class="page">
            <div class="header">
                <div>
                    <button class="home-btn" onclick="showPage(1)"> Hoofdmenu</button>
                    <button class="back-btn" onclick="showPage(3)"> Terug</button>
                </div>
                <h1 id="matchTitleSelect">Kies Witte Bal</h1>
                <div style="width: 70px;"></div>
            </div>
            
            <div class="ball-selection-container">
                <div class="ball-selection-title">Wie speelt met de witte bal?<br><small>(De andere speelt automatisch met geel)</small></div>
                
                <div class="ball-option" onclick="selectWhitePlayer(1)">
                    <div class="ball-circle white" id="whiteBall1">
                        <div id="whiteBall1Text">Speler 1</div>
                    </div>
                    <div class="ball-option-label" id="whiteBall1Label">Speler 1</div>
                </div>
                
                <div class="ball-option" onclick="selectWhitePlayer(2)">
                    <div class="ball-circle white" id="whiteBall2">
                        <div id="whiteBall2Text">Speler 2</div>
                    </div>
                    <div class="ball-option-label" id="whiteBall2Label">Speler 2</div>
                </div>
                
                <button id="startMatchBtn" class="start-match-btn disabled-btn" onclick="startMatch()" disabled>
                     Start Match
                </button>
                
                <div class="info-box" style="margin-top: 20px;">
                     <strong>Belangrijk:</strong> De speler met de witte bal begint altijd en staat LINKS op het scorebord.
                </div>
            </div>
        </div>
        
        <!-- PAGINA 5: Scoring -->
        <div id="page5" class="page">
            <div class="header">
                <div id="matchHeaderButtons">
                    <button class="home-btn" onclick="showPage(1)"> Hoofdmenu</button>
                    <button class="back-btn" onclick="showPage(4)"> Terug</button>
                </div>
                <h1 id="matchTitle"></h1>
                <div style="width: 70px;"></div>
            </div>
            
            <!-- MATCH ENDED ALERT -->
            <div id="matchEndedAlert" class="match-ended" style="display: none;"></div>
            
            <!-- HUIDIGE BEURT IN HET MIDDEN MET WIT/GEEL SCORES -->
            <div class="current-turn-container">
                <!-- WIT SPELER SCORE (LINKS) -->
                <div class="side-score-display white" id="whitePlayerDisplay">
                    <div class="side-score-name" id="whitePlayerName">Wit</div>
                    <div class="side-score-value" id="whitePlayerScore">0</div>
                </div>
                
                <!-- HUIDIGE BEURT INFO (MIDDEN) -->
                <div class="current-turn" id="currentPlayerDisplay"></div>
                
                <!-- GEEL SPELER SCORE (RECHTS) -->
                <div class="side-score-display yellow" id="yellowPlayerDisplay">
                    <div class="side-score-name" id="yellowPlayerName">Geel</div>
                    <div class="side-score-value" id="yellowPlayerScore">0</div>
                </div>
            </div>
            
            <!-- NIEUWE CURRENT SCORE DISPLAY BOVEN SPELERKAARTEN -->
            <div class="current-score-container">
                <div class="current-score-display player1-current inactive" id="player1CurrentScore">
                    <div class="current-score-name" id="player1ScoreName">Speler 1</div>
                    <div class="current-score-value">0</div>
                </div>
                
                <div class="current-score-display player2-current inactive" id="player2CurrentScore">
                    <div class="current-score-name" id="player2ScoreName">Speler 2</div>
                    <div class="current-score-value">0</div>
                </div>
            </div>
            
            <!-- SCORE CONTROLS MET PLUS EN MINUS KNOBBEN -->
            <div class="score-controls">
                <button class="score-btn plus-btn left-plus" onclick="changeScore(1)">+</button>
                
                <div class="score-middle">
                    <button class="score-btn minus-btn" onclick="changeScore(-1)"></button>
                </div>
                
                <button class="score-btn plus-btn right-plus" onclick="changeScore(1)">+</button>
            </div>
            
            <div class="action-buttons">
                <button class="action-btn confirm-btn" onclick="addScore()" id="confirmScoreBtn">
                    Einde beurt voor <span id="currentPlayerBtnName">Speler</span> en score toevoegen
                </button>
            </div>
            
            <div class="players-container">
                <div class="player-card player-white" id="player1Card"></div>
                <div class="player-card player-yellow" id="player2Card"></div>
            </div>
        </div>
        
        <!-- PAGINA 7: Beheer matchen -->
        <div id="page7" class="page">
            <div class="header">
                <div>
                    <button class="home-btn" onclick="showPage(1)"> Hoofdmenu</button>
                    <div style="width: 70px;"></div>
                </div>
                <h1> Beheer Matchen</h1>
                <div style="display: flex; gap: 10px;">
                    <button class="download-btn" onclick="changeAdminPassword()" style="background: #9b59b6;"> Wachtwoord</button>
                </div>
            </div>
            
            <div class="download-section">
                <h3> Download Resultaten</h3>
                <div style="margin: 20px 0;">
                    <button class="download-btn" onclick="downloadAllResults()" style="width: 100%; padding: 15px; margin-bottom: 10px;">
                         Download Voltooide Matchen
                    </button>
                    <p style="margin-top: 10px; color: #bdc3c7; font-size: 0.9em;">
                        Download voltooide matchen naar CSV. Matchen worden naar "Gedownloade Matchen" verplaatst.
                    </p>
                </div>
                
                <div style="margin: 20px 0;">
                    <label for="filterDate" style="display: block; margin-bottom: 10px; font-weight: bold;">Filter op datum:</label>
                    <input type="date" id="filterDate" class="date-input" style="margin-bottom: 15px;">
                    <button class="download-btn" onclick="downloadFilteredResults()" style="width: 100%; padding: 15px;">
                         Download Gefilterde Resultaten
                    </button>
                    <p style="margin-top: 10px; color: #bdc3c7; font-size: 0.9em;">
                        Download voltooide matchen voor een specifieke datum.
                    </p>
                </div>
            </div>
            
            <div class="matches-tabs" id="matchesTabs">
                <button class="tab-btn active" onclick="showMatchesTab('active')" id="tabActive">
                    Actieve Matchen
                    <span class="badge" id="badgeActive">0</span>
                </button>
                <button class="tab-btn" onclick="showMatchesTab('completed')" id="tabCompleted">
                    Voltooide Matchen
                    <span class="badge" id="badgeCompleted">0</span>
                </button>
                <button class="tab-btn" onclick="showMatchesTab('downloaded')" id="tabDownloaded">
                    Gedownloade Matchen
                    <span class="badge" id="badgeDownloaded">0</span>
                </button>
                <!-- NIEUW: Spelers tabblad -->
                <button class="tab-btn" onclick="showMatchesTab('players')" id="tabPlayers">
                     Spelers Beheer
                    <span class="badge" id="badgePlayers">0</span>
                </button>
                <!-- NIEUW: Speeldagen tabblad -->
                <button class="tab-btn speeldagen" onclick="showMatchesTab('speeldagen')" id="tabSpeeldagen">
                     Speeldagen Beheer
                    <span class="badge" id="badgeSpeeldagen">0</span>
                </button>
            </div>
            
            <div id="matchesTabContent">
                <div class="tab-content active" id="tabContentActive">
                    <!-- Actieve matchen komen hier -->
                </div>
                <div class="tab-content" id="tabContentCompleted">
                    <!-- Voltooide matchen komen hier -->
                </div>
                <div class="tab-content" id="tabContentDownloaded">
                    <!-- Gedownloade matchen komen hier -->
                </div>
                <!-- NIEUW: Spelers beheer tab -->
                <div class="tab-content" id="tabContentPlayers">
                    <div class="players-management-container">
                        <!-- Hier komt de volledige spelersbeheer interface -->
                    </div>
                </div>
                <!-- NIEUW: Speeldagen beheer tab -->
                <div class="tab-content" id="tabContentSpeeldagen">
                    <div class="speeldagen-management-container">
                        <!-- Hier komt de speeldagen beheer interface -->
                    </div>
                </div>
            </div>
        </div>

	<!-- Speler Statistieken Pagina  8-->
	<div id="page8" class="page">
	    <div class="header">
	        <button class="home-btn" onclick="showPage(1)"> Hoofdmenu</button>
                <button class="back-btn" onclick="showPage('1')"> Terug</button>
	        <h1>Speler Statistieken</h1>
	    </div>
	    <div id="statsContent">
	        <!-- Wordt gevuld door stats.js -->
	    </div>
	</div>
	
	<!-- Rangschikking Pagina -->
	<div id="page9" class="page">
	    <div class="header">
	        <button class="home-btn" onclick="showPage(1)"> Hoofdmenu</button>
                <button class="back-btn" onclick="showPage('1')"> Terug</button>
	        <h1>Rangschikking</h1>
	    </div>
	    <div id="rankingContent">
	        <!-- Wordt gevuld door stats.js -->
	    </div>
	</div>
    </div>
    <script>
        // ==================== LOGIN FUNCTIES ====================
        const CLUB_PASSWORD = "Biljart8647";
        const APP_VERSION = "1.0.5";
        const DEFAULT_ADMIN_PASSWORD = "admin123";
        
        function checkPassword() {
            const input = document.getElementById('passwordInput').value;
            const errorDiv = document.getElementById('errorMessage');
            
            if (input === CLUB_PASSWORD) {
                // Markeer als ingelogd
                document.getElementById('bodyElement').classList.add('logged-in');
                sessionStorage.setItem('biljart_authenticated', 'true');
                initializeApp();
            } else {
                errorDiv.style.display = 'block';
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordInput').focus();
                errorDiv.style.animation = 'shake 0.5s';
                setTimeout(() => errorDiv.style.animation = '', 500);
            }
        }
        
        // Enter toets ondersteuning
        document.getElementById('passwordInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkPassword();
            }
        });
        
        // Controleer bij laden of al ingelogd
        if (sessionStorage.getItem('biljart_authenticated')) {
            document.getElementById('bodyElement').classList.add('logged-in');
            initializeApp();
        }

        // ==================== APP FUNCTIES ====================
        function initializeApp() {
            // ==================== GLOBALE VARIABELEN ====================
            window.state = {
                currentPage: 1,
                selectedDate: '',
                matches: [],
                downloadedMatches: [],
                players: [],
                currentMatch: null,
                player1: { score: 0, turns: [], target: 0, beurtNummer: 1, highestSeries: 0, isWhite: false },
                player2: { score: 0, turns: [], target: 0, beurtNummer: 1, highestSeries: 0, isWhite: false },
                currentPlayer: 1,
                turnNumber: 1,
                matchEnded: false,
                isFirstPlayerInRound: true,
                pendingEnd: false,
                currentInput: 0,
                selectedWhitePlayer: null,
                newMatch: {
                    player1: null,
                    player2: null,
                    target1: 0,
                    target2: 0
                },
                currentMatchesTab: 'active',
                firstToTarget: null, // Wie bereikte als eerste het target?
                isNabeurt: false, // NIEUW: Geeft aan of we in een nabeurt zitten
		// NIEUWE DATA STRUCTUUR - toevoegen in initializeApp() na andere state variabelen
	        spelerExtraInfo: [], // Hier komt de extra data uit Excel kolommen E-J
	        speeldagen: [] // Hier komen de speeldagen uit kolom J

            };

            window.editingPlayerIndex = -1;
            window.editingPlayerData = null;

            // ==================== CACHE MANAGEMENT ====================
            function clearOldCache() {
                if (localStorage.getItem('app_version') !== APP_VERSION) {
                    console.log('Nieuwe versie - clearing oude cache...');
                    localStorage.clear();
                    localStorage.setItem('app_version', APP_VERSION);
                }
            }

            // ==================== ADMIN PASSWORD FUNCTIES ====================
            function getAdminPassword() {
                const savedPassword = localStorage.getItem('biljartAdminPassword');
                return savedPassword || DEFAULT_ADMIN_PASSWORD;
            }

            function setAdminPassword(newPassword) {
                if (newPassword && newPassword.trim() !== '') {
                    localStorage.setItem('biljartAdminPassword', newPassword.trim());
                    return true;
                }
                return false;
            }

            window.checkAdminPassword = function() {
                const currentPassword = getAdminPassword();
                const enteredPassword = prompt("Voer beheerderswachtwoord in:");
                
                if (enteredPassword === null) return;
                
                if (enteredPassword === currentPassword) {
                    showPage(7);
                } else {
                    alert(" Onjuist wachtwoord!");
                }
            }

            window.changeAdminPassword = function() {
                const currentPassword = getAdminPassword();
                const oldPassword = prompt("Voer huidig wachtwoord in:");
                
                if (oldPassword === null) return;
                
                if (oldPassword !== currentPassword) {
                    alert(" Huidig wachtwoord is onjuist!");
                    return;
                }
                
                const newPassword1 = prompt("Voer nieuw wachtwoord in (min. 4 tekens):");
                if (newPassword1 === null) return;
                
                if (newPassword1.length < 4) {
                    alert(" Wachtwoord moet minimaal 4 tekens lang zijn!");
                    return;
                }
                
                const newPassword2 = prompt("Herhaal nieuw wachtwoord:");
                if (newPassword2 === null) return;
                
                if (newPassword1 !== newPassword2) {
                    alert(" Wachtwoorden komen niet overeen!");
                    return;
                }
                
                if (setAdminPassword(newPassword1)) {
                    alert(" Wachtwoord succesvol gewijzigd!");
                } else {
                    alert(" Fout bij wijzigen wachtwoord");
                }
            }

            // ==================== HELPER FUNCTIES ====================
            function formatDateForInput(date) {
                const d = new Date(date);
                const year = d.getFullYear();
                const month = String(d.getMonth() + 1).padStart(2, '0');
                const day = String(d.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            }

            function formatDateDisplay(dateStr) {
                if (!dateStr) return '';
                const parts = dateStr.split('-');
                if (parts.length === 3) {
                    return `${parts[2]}/${parts[1]}/${parts[0]}`;
                }
                return dateStr;
            }

            function formatDateForCSV(dateStr) {
                return formatDateDisplay(dateStr);
            }

            // NIEUWE FUNCTIE: Formatteer datum volledig zoals "zaterdag 7 februari 2026"
            function formatDateFull(dateStr) {
                if (!dateStr) return '';
                
                const date = new Date(dateStr);
                if (isNaN(date.getTime())) return dateStr;
                
                const dagen = ['zondag', 'maandag', 'dinsdag', 'woensdag', 'donderdag', 'vrijdag', 'zaterdag'];
                const maanden = ['januari', 'februari', 'maart', 'april', 'mei', 'juni', 
                                 'juli', 'augustus', 'september', 'oktober', 'november', 'december'];
                
                const dagNaam = dagen[date.getDay()];
                const dag = date.getDate();
                const maand = maanden[date.getMonth()];
                const jaar = date.getFullYear();
                
                return `${dagNaam} ${dag} ${maand} ${jaar}`;
            }

            // NIEUWE FUNCTIES VOOR SCORE BUTTONS
            function enableScoreButtons() {
                document.querySelectorAll('.score-btn').forEach(btn => {
                    btn.disabled = false;
                    btn.style.opacity = '1';
                    btn.style.cursor = 'pointer';
                });
                
                const confirmBtn = document.getElementById('confirmScoreBtn');
                if (confirmBtn) {
                    confirmBtn.disabled = false;
                    confirmBtn.style.opacity = '1';
                    confirmBtn.style.cursor = 'pointer';
                }
            }

            function disableScoreButtons() {
                document.querySelectorAll('.score-btn').forEach(btn => {
                    btn.disabled = true;
                    btn.style.opacity = '0.5';
                    btn.style.cursor = 'not-allowed';
                });
                
                const confirmBtn = document.getElementById('confirmScoreBtn');
                if (confirmBtn) {
                    confirmBtn.disabled = true;
                    confirmBtn.style.opacity = '0.5';
                    confirmBtn.style.cursor = 'not-allowed';
                }
            }

            function updateCurrentTurnSize() {
                const currentTurn = document.getElementById('currentPlayerDisplay');
                if (!currentTurn) return;
                
                // Bepaal of er extra info is
                const hasExtraInfo = state.isNabeurt || state.firstToTarget;
                
                if (hasExtraInfo) {
                    currentTurn.classList.add('has-extra-info');
                } else {
                    currentTurn.classList.remove('has-extra-info');
                }
                
            }

            


            

            // NIEUWE FUNCTIE OM WIT/GEEL SCORES BIJ TE WERKEN
            function updateSideScoreDisplays() {
                // Bepaal wie wit en wie geel is
                const whitePlayer = state.player1.isWhite ? state.player1 : state.player2;
                const yellowPlayer = state.player2.isWhite ? state.player1 : state.player2;
                
                const whiteName = state.player1.isWhite ? state.currentMatch.p1 : state.currentMatch.p2;
                const yellowName = state.player2.isWhite ? state.currentMatch.p1 : state.currentMatch.p2;
                
                // Update de displays
                document.getElementById('whitePlayerName').textContent = whiteName;
                document.getElementById('whitePlayerScore').textContent = whitePlayer.score;
                
                document.getElementById('yellowPlayerName').textContent = yellowName;
                document.getElementById('yellowPlayerScore').textContent = yellowPlayer.score;
            }

            // ==================== PAGINA FUNCTIES ====================
window.showPage = function(pageNum) {
    // 1. Converteer naar getal als het een string is zoals "Page2"
    let actualPageNum;
    
    if (typeof pageNum === 'string') {
        // Als het "Page2" is, haal het nummer eruit
        if (pageNum.startsWith('Page')) {
            actualPageNum = parseInt(pageNum.replace('Page', ''));
        } else {
            // Als het gewoon "2" is
            actualPageNum = parseInt(pageNum);
        }
    } else {
        actualPageNum = pageNum;
    }
    
    // 2. Valideer dat we een geldig nummer hebben
    if (isNaN(actualPageNum) || actualPageNum < 1) {
        console.error(` Ongeldig paginanummer: ${pageNum} -> ${actualPageNum}`);
        actualPageNum = 1; // Fallback naar home
    }
    
    const pageId = `page${actualPageNum}`;
    const targetPage = document.getElementById(pageId);
    
    // 3. Verberg alle pagina's
    document.querySelectorAll('.page').forEach(p => {
        if (p && p.classList) {
            p.classList.remove('active');
        }
    });
    
    // 4. Controleer of de pagina bestaat
    if (!targetPage) {
        console.error(` Pagina ${actualPageNum} (${pageId}) niet gevonden!`);
        
        // Fallback naar pagina 1
        const homePage = document.getElementById('page1');
        if (homePage) {
            homePage.classList.add('active');
            state.currentPage = 1;
        }
        return;
    }
    
    // 5. Toon de pagina
    targetPage.classList.add('active');
    state.currentPage = actualPageNum;
    
    // 6. Voer pagina-specifieke code uit
    if (actualPageNum === 1) {
        const today = new Date();
        const dateInput = document.getElementById('dateSelect');
        if (dateInput) {


            dateInput.value = formatDateForInput(today);
            state.selectedDate = dateInput.value;
        }
    } else if (actualPageNum === 2) {
        if (typeof loadFilteredMatches === 'function') loadFilteredMatches();
    } else if (actualPageNum === 3) {
        if (typeof setupNewMatchPage === 'function') setupNewMatchPage();
    } else if (actualPageNum === 4) {
        if (typeof updateBallSelectionPage === 'function') updateBallSelectionPage();
    } else if (actualPageNum === 5) {
        document.querySelectorAll('.dynamic-needed').forEach(el => el.remove());
    } else if (actualPageNum === 7) {
        if (typeof loadMatchesTabContent === 'function') {
            loadMatchesTabContent();
            const filterDate = document.getElementById('filterDate');
            if (filterDate) filterDate.value = formatDateForInput(new Date());
        }
    } else if (actualPageNum === 8) {
        if (typeof loadStatsPage === 'function') {
            loadStatsPage();
        } else {
            console.warn('loadStatsPage functie nog niet beschikbaar');
        }
    } else if (actualPageNum === 9) {
        if (typeof loadRankingPage === 'function') {
            loadRankingPage();
        } else {
            console.warn('loadRankingPage functie nog niet beschikbaar');
        }
    }
};

            window.goToPage2 = function() {
                const dateInput = document.getElementById('dateSelect');
                const selectedDate = dateInput.value;
                
                if (!selectedDate) {
                    alert("Selecteer eerst een datum!");
                    return;
                }
                
                state.selectedDate = selectedDate;
                showPage(2);
            }

            function loadFilteredMatches() {
                const matchList = document.getElementById('matchList');
                const title = document.getElementById('matchListTitle');
                
                const displayDate = formatDateDisplay(state.selectedDate);
                title.textContent = `Matchen - ${displayDate}`;

                const filteredMatches = state.matches.filter(match => {
                    return match.date === state.selectedDate && !match.completed;
                });
                
                if (filteredMatches.length === 0) {
                    matchList.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #95a5a6;">
                            <p>Maak een nieuwe match</p>
                            <button class="new-match-btn" onclick="createNewMatch()"> Nieuwe Match</button>
                        </div>
                    `;
                    return;
                }
                
                matchList.innerHTML = filteredMatches.map(match => `
                    <div class="match-card" onclick="selectMatch(${match.id})">
                        <h3>${match.p1} vs ${match.p2}</h3>
                        <p class="match-info">
                             Doelpunten: ${match.target1} - ${match.target2}<br>
                             Datum: ${formatDateDisplay(match.date)}
                        </p>
                    </div>
                `).join('');
            }

            window.selectMatch = function(matchId) {
                const match = state.matches.find(m => m.id === matchId);
                if (match && match.completed) {
                    alert("Deze match is al afgerond. Kies een andere match.");
                    return;
                }
                
                state.currentMatch = match;
                state.selectedWhitePlayer = null;
                
                document.getElementById('matchTitleSelect').textContent = `${match.p1} vs ${match.p2}`;
                
                showPage(4);
            }

            window.createNewMatch = function() {
                showPage(3);
            }

            // ==================== NIEUWE MATCH CREREN ====================
            function setupNewMatchPage() {
                document.getElementById('newMatchTitle').textContent = `Nieuwe Match`;
                
                document.getElementById('newMatchInfo').innerHTML = 
                    `Maak een nieuwe match aan voor:<br>
                    <strong>${formatDateDisplay(state.selectedDate)}</strong>`;
                
                state.newMatch = {
                    player1: null,
                    player2: null,
                    target1: 0,
                    target2: 0
                };
                
                document.getElementById('player1Name').textContent = 'Niet geselecteerd';
                document.getElementById('player1Details').textContent = 'Klik om speler te selecteren';
                document.getElementById('player1Target').value = '';
                document.getElementById('player1Box').classList.remove('selected');
                
                document.getElementById('player2Name').textContent = 'Niet geselecteerd';
                document.getElementById('player2Details').textContent = 'Klik om speler te selecteren';
                document.getElementById('player2Target').value = '';
                document.getElementById('player2Box').classList.remove('selected');
                
                displayAvailablePlayers();
            }

            function displayAvailablePlayers() {
                const container = document.getElementById('availablePlayers');
                
                if (state.players.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 20px; color: #95a5a6;">
                            <p>Geen spelers gevonden</p>
                            <p><small>Spelers worden geladen van GitHub</small></p>
                        </div>
                    `;
                    return;
                }
                
                state.players.sort((a, b) => a.name.localeCompare(b.name));
                
                let html = '<h3 style="margin-bottom: 15px; color: #ecf0f1;">Beschikbare spelers:</h3>';
                html += '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px;">';
                
                state.players.forEach((player, index) => {
                    const isSelected = (state.newMatch.player1 && state.newMatch.player1.name === player.name) ||
                                     (state.newMatch.player2 && state.newMatch.player2.name === player.name);
                    
                    html += `
                        <div class="player-select-box ${isSelected ? 'selected' : ''}" 
                             onclick="selectAvailablePlayer(${index})"
                             style="${isSelected ? 'opacity: 0.6; cursor: not-allowed;' : ''}">
                            <h3>${player.name}</h3>
                            <p>Gemiddelde: ${player.tsg || 'N/A'}</p>
                            <p>Standaard target: ${player.target}</p>
                            ${isSelected ? '<p style="color: #e74c3c; margin-top: 5px;"> Al geselecteerd</p>' : ''}
                        </div>
                    `;
                });
                
                html += '</div>';
                container.innerHTML = html;
            }

            window.selectAvailablePlayer = function(playerIndex) {
                if (playerIndex < 0 || playerIndex >= state.players.length) return;
                
                const player = state.players[playerIndex];
                
                let selectedPlayerNum = null;
                if (!state.newMatch.player1) {
                    selectedPlayerNum = 1;
                } else if (!state.newMatch.player2 && state.newMatch.player1.name !== player.name) {
                    selectedPlayerNum = 2;
                } else {
                    alert("Speler is al geselecteerd of beide spelers zijn al geselecteerd.");
                    return;
                }
                
                if (selectedPlayerNum === 1) {
                    state.newMatch.player1 = player;
                    state.newMatch.target1 = player.target;
                    
                    document.getElementById('player1Name').textContent = player.name;
                    document.getElementById('player1Details').innerHTML = `
                        Gemiddelde: ${player.tsg || 'N/A'}<br>
                        Standaard target: ${player.target}
                    `;
                    document.getElementById('player1Target').value = player.target;
                    document.getElementById('player1Box').classList.add('selected');
                } else {
                    state.newMatch.player2 = player;
                    state.newMatch.target2 = player.target;
                    
                    document.getElementById('player2Name').textContent = player.name;
                    document.getElementById('player2Details').innerHTML = `
                        Gemiddelde: ${player.tsg || 'N/A'}<br>
                        Standaard target: ${player.target}
                    `;
                    document.getElementById('player2Target').value = player.target;
                    document.getElementById('player2Box').classList.add('selected');
                }
                
                displayAvailablePlayers();
                validateTargets();
            }

            window.selectPlayerForNewMatch = function(playerNum) {
                if (playerNum === 1 && state.newMatch.player1) {
                    document.getElementById('player1Target').focus();
                    document.getElementById('player1Target').select();
                } else if (playerNum === 2 && state.newMatch.player2) {
                    document.getElementById('player2Target').focus();
                    document.getElementById('player2Target').select();
                } else {
                    document.getElementById('availablePlayers').scrollIntoView({ behavior: 'smooth' });
                }
            }

            window.validateTargets = function() {
                const target1Input = document.getElementById('player1Target');
                const target2Input = document.getElementById('player2Target');
                
                state.newMatch.target1 = parseInt(target1Input.value) || 0;
                state.newMatch.target2 = parseInt(target2Input.value) || 0;
                
                if (target1Input.value) {
                    const val = parseInt(target1Input.value);
                    if (val < 1) target1Input.value = 1;
                    if (val > 200) target1Input.value = 200;
                    state.newMatch.target1 = parseInt(target1Input.value);
                }
                
                if (target2Input.value) {
                    const val = parseInt(target2Input.value);
                    if (val < 1) target2Input.value = 1;
                    if (val > 200) target2Input.value = 200;
                    state.newMatch.target2 = parseInt(target2Input.value);
                }
                
                const canCreate = state.newMatch.player1 && 
                                state.newMatch.player2 && 
                                state.newMatch.target1 > 0 && 
                                state.newMatch.target2 > 0 &&
                                state.newMatch.player1.name !== state.newMatch.player2.name;
                
                const createBtn = document.getElementById('createMatchBtn');
                createBtn.disabled = !canCreate;
                createBtn.style.backgroundColor = canCreate ? '#2ecc71' : '#7f8c8d';
            }

            window.createManualMatch = function() {
                if (!state.newMatch.player1 || !state.newMatch.player2) {
                    alert("Selecteer eerst beide spelers!");
                    return;
                }
                
                if (state.newMatch.player1.name === state.newMatch.player2.name) {
                    alert("Kies twee verschillende spelers!");
                    return;
                }
                
                if (state.newMatch.target1 <= 0 || state.newMatch.target2 <= 0) {
                    alert("Vul geldige target punten in!");
                    return;
                }
                
                const newId = state.matches.length > 0 ? Math.max(...state.matches.map(m => m.id)) + 1 : 1;
                
                const newMatch = {
                    id: newId,
                    date: state.selectedDate,
                    p1: state.newMatch.player1.name,
                    p2: state.newMatch.player2.name,
                    target1: state.newMatch.target1,
                    target2: state.newMatch.target2,
                    completed: false,
                    whitePlayer: null,
                    p1Score: 0,
                    p2Score: 0,
                    p1Turns: [],
                    p2Turns: [],
                    p1Highest: 0,
                    p2Highest: 0
                };
                
                state.matches.push(newMatch);
                saveStateToStorage();
                
                alert(` Nieuwe match aangemaakt:\n${state.newMatch.player1.name} vs ${state.newMatch.player2.name}\nTargets: ${state.newMatch.target1} - ${state.newMatch.target2}`);
                
                showPage(2);
            }

            // ==================== BAL KLEUR SELECTIE ====================
            function updateBallSelectionPage() {
                if (!state.currentMatch) return;
                
                document.getElementById('whiteBall1Text').textContent = state.currentMatch.p1;
                document.getElementById('whiteBall2Text').textContent = state.currentMatch.p2;
                document.getElementById('whiteBall1Label').textContent = state.currentMatch.p1;
                document.getElementById('whiteBall2Label').textContent = state.currentMatch.p2;
                
                document.querySelectorAll('.ball-circle').forEach(ball => {
                    ball.classList.remove('selected');
                });
                
                const startBtn = document.getElementById('startMatchBtn');
                startBtn.disabled = state.selectedWhitePlayer === null;
                startBtn.className = state.selectedWhitePlayer === null ? 
                    'start-match-btn disabled-btn' : 'start-match-btn';
            }

            window.selectWhitePlayer = function(player) {
                state.selectedWhitePlayer = player;
                
                document.querySelectorAll('.ball-circle').forEach(ball => {
                    ball.classList.remove('selected');
                });
                
                const selectedBall = player === 1 ? 
                    document.getElementById('whiteBall1') : 
                    document.getElementById('whiteBall2');
                
                if (selectedBall) {
                    selectedBall.classList.add('selected');
                }
                
                const startBtn = document.getElementById('startMatchBtn');
                startBtn.disabled = false;
                startBtn.className = 'start-match-btn';
            }

            window.startMatch = function() {
                if (!state.selectedWhitePlayer) {
                    alert("Selecteer eerst wie met wit speelt!");
                    return;
                }
                
                const whitePlayer = state.selectedWhitePlayer;
                
                // RESET ALLE SPELER VARIABELEN
                state.player1 = { 
                    score: 0, 
                    turns: [], 
                    target: 0, 
                    beurtNummer: 1, 
                    highestSeries: 0, 
                    isWhite: false 
                };
                state.player2 = { 
                    score: 0, 
                    turns: [], 
                    target: 0, 
                    beurtNummer: 1, 
                    highestSeries: 0, 
                    isWhite: false 
                };
                state.firstToTarget = null;
                state.isNabeurt = false;
                state.currentInput = 0;
                state.matchEnded = false; // ZET DIT EXPLICIET OP FALSE
                
                state.currentMatch.originalP1 = state.currentMatch.p1;
                state.currentMatch.originalP2 = state.currentMatch.p2;
                state.currentMatch.originalTarget1 = state.currentMatch.target1;
                state.currentMatch.originalTarget2 = state.currentMatch.target2;
                
                if (whitePlayer === 2) {
                    [state.currentMatch.p1, state.currentMatch.p2] = [state.currentMatch.p2, state.currentMatch.p1];
                    [state.currentMatch.target1, state.currentMatch.target2] = [state.currentMatch.target2, state.currentMatch.target1];
                    
                    state.player1.isWhite = true;
                    state.player2.isWhite = false;
                    state.player1.target = state.currentMatch.target1;
                    state.player2.target = state.currentMatch.target2;
                    
                    state.currentMatch.whitePlayer = 2;
                } else {
                    state.player1.isWhite = true;
                    state.player2.isWhite = false;
                    state.player1.target = state.currentMatch.target1;
                    state.player2.target = state.currentMatch.target2;
                    state.currentMatch.whitePlayer = 1;
                }
                
                state.currentPlayer = 1;
                state.turnNumber = 1;
                state.isFirstPlayerInRound = true;
                state.pendingEnd = false;
                
                // VERWIJDER de match ended alert
                const matchEndedAlert = document.getElementById('matchEndedAlert');
                if (matchEndedAlert) {
                    matchEndedAlert.style.display = 'none';
                    matchEndedAlert.innerHTML = '';
                }
                
                document.getElementById('matchTitle').textContent = 
                    `${state.currentMatch.p1} vs ${state.currentMatch.p2}`;
                
                // Zet de namen in de score displays
                document.getElementById('player1ScoreName').textContent = state.currentMatch.p1;
                document.getElementById('player2ScoreName').textContent = state.currentMatch.p2;
                
                // UPDATE DE SIDE SCORE DISPLAYS
                updateSideScoreDisplays();
                
                // SCHAKEL DE KNOPPEN WEER IN
                enableScoreButtons();
                
                // Reset de current score display
                document.getElementById('player1CurrentScore').querySelector('.current-score-value').textContent = '0';
                document.getElementById('player2CurrentScore').querySelector('.current-score-value').textContent = '0';
                
                // Toon alleen de display van de huidige speler
                document.getElementById('player1CurrentScore').classList.remove('inactive');
                document.getElementById('player1CurrentScore').classList.add('active');
                document.getElementById('player2CurrentScore').classList.remove('active');
                document.getElementById('player2CurrentScore').classList.add('inactive');
                
                showPage(5);
                updateScoringPage();
            }

            // ==================== SCORING FUNCTIES ====================
            window.changeScore = function(delta) {
                // Controleer of match is afgelopen
                if (state.matchEnded) {
                    alert("Match is afgelopen! Start een nieuwe match.");
                    return;
                }
                
                const player = state.currentPlayer === 1 ? state.player1 : state.player2;
                const target = state.currentPlayer === 1 ? state.player1.target : state.player2.target;
                
                // Als de speler al zijn target heeft bereikt, laat hem geen punten meer toevoegen
                if (player.score >= target) {
                    state.currentInput = 0;
                    alert("Speler heeft al zijn target bereikt! Klik op 'Einde beurt' om door te gaan.");
                    return;
                }
                
                // Bereken wat de nieuwe score zou zijn als we delta toevoegen
                const potentialNewInput = state.currentInput + delta;
                const potentialNewTotalScore = player.score + potentialNewInput;
                
                // Als de nieuwe totaalscore boven het target zou komen, beperk dan
                if (potentialNewTotalScore > target) {
                    // Bereken het maximale aantal punten dat nog mag worden toegevoegd
                    const maxAllowed = target - player.score;
                    state.currentInput = maxAllowed;
                    updateCurrentScoreDisplay();
                    updateDynamicNeededDisplay();
                    return;
                }
                
                // Normale situatie: voeg delta toe, maar zorg dat het niet negatief wordt
                state.currentInput = Math.max(0, potentialNewInput);
                updateCurrentScoreDisplay();
                updateDynamicNeededDisplay();
            }

            function updateCurrentScoreDisplay() {
                // Update de huidige score displays
                const player1ScoreValue = document.getElementById('player1CurrentScore').querySelector('.current-score-value');
                const player2ScoreValue = document.getElementById('player2CurrentScore').querySelector('.current-score-value');
                
                if (player1ScoreValue) player1ScoreValue.textContent = state.currentInput;
                if (player2ScoreValue) player2ScoreValue.textContent = state.currentInput;
                
                // Toon alleen de display van de huidige speler
                if (state.currentPlayer === 1) {
                    document.getElementById('player1CurrentScore').classList.remove('inactive');
                    document.getElementById('player1CurrentScore').classList.add('active');
                    document.getElementById('player2CurrentScore').classList.remove('active');
                    document.getElementById('player2CurrentScore').classList.add('inactive');
                } else {
                    document.getElementById('player1CurrentScore').classList.remove('active');
                    document.getElementById('player1CurrentScore').classList.add('inactive');
                    document.getElementById('player2CurrentScore').classList.remove('inactive');
                    document.getElementById('player2CurrentScore').classList.add('active');
                }
            }

            function updateDynamicNeededDisplay() {
                document.querySelectorAll('.dynamic-needed').forEach(el => el.remove());
                
                const player = state.currentPlayer === 1 ? state.player1 : state.player2;
                const target = state.currentPlayer === 1 ? state.player1.target : state.player2.target;
                const dynamicNeeded = Math.max(0, target - player.score - state.currentInput);
                
                if (dynamicNeeded <= 5 && dynamicNeeded > 0) {
                    const playerCard = state.currentPlayer === 1 ? 
                        document.getElementById('player1Card') : 
                        document.getElementById('player2Card');
                    
                    const dynamicDisplay = document.createElement('div');
                    dynamicDisplay.className = 'dynamic-needed';
                    dynamicDisplay.innerHTML = ` Nog ${dynamicNeeded} punt${dynamicNeeded !== 1 ? 'en' : ''} nodig`;
                    
                    if (dynamicNeeded <= 3) {
                        dynamicDisplay.style.background = 'linear-gradient(135deg, #ff6b6b, #ee5a24)';
                        dynamicDisplay.innerHTML = ` Nog ${dynamicNeeded} punt${dynamicNeeded !== 1 ? 'en' : ''} nodig!`;
                    }
                    
                    playerCard.appendChild(dynamicDisplay);
                }
                
                updateStaticNeededValues();
            }

            function updateStaticNeededValues() {
                const needed1 = Math.max(0, state.player1.target - state.player1.score - 
                    (state.currentPlayer === 1 ? state.currentInput : 0));
                const statValue1 = document.querySelector('#player1Card .stat-item:nth-child(5) .stat-value');
                if (statValue1) {
                    statValue1.textContent = needed1;
                    if (needed1 <= 5 && needed1 > 0) {
                        statValue1.style.color = '#e74c3c';
                        statValue1.style.fontWeight = 'bold';
                    } else {
                        statValue1.style.color = '';
                        statValue1.style.fontWeight = '';
                    }
                }
                
                const needed2 = Math.max(0, state.player2.target - state.player2.score - 
                    (state.currentPlayer === 2 ? state.currentInput : 0));
                const statValue2 = document.querySelector('#player2Card .stat-item:nth-child(5) .stat-value');
                if (statValue2) {
                    statValue2.textContent = needed2;
                    if (needed2 <= 5 && needed2 > 0) {
                        statValue2.style.color = '#e74c3c';
                        statValue2.style.fontWeight = 'bold';
                    } else {
                        statValue2.style.color = '';
                        statValue2.style.fontWeight = '';
                    }
                }
            }

            window.addScore = function() {
                // Controleer of match is afgelopen
                if (state.matchEnded) {
                    alert("Match is afgelopen! Klik op hoofdmenu om een nieuwe match te starten.");
                    return;
                }
                
                const score = state.currentInput;
                const player = state.currentPlayer === 1 ? state.player1 : state.player2;
                const target = state.currentPlayer === 1 ? state.player1.target : state.player2.target;
                
                // Als speler al zijn target heeft bereikt, stop dan
                if (player.score >= target) {
                    alert("Speler heeft al zijn target bereikt! Klik op 'Einde beurt' om door te gaan.");
                    return;
                }
                
                // Voeg score toe
                player.score += score;
                player.turns.push(score);
                
                if (score > player.highestSeries) {
                    player.highestSeries = score;
                }
                
                player.beurtNummer++;
                
                // Controleer of target bereikt is IN DEZE BEURT
                const targetReached = player.score >= target;
                
                // Als target bereikt en eerste die target bereikt
                if (targetReached && state.firstToTarget === null) {
                    state.firstToTarget = state.currentPlayer;
                    
                    if (state.currentPlayer === 1) {
                        // Speler 1 bereikt target eerst -> Speler 2 krijgt nabeurt
                        state.isNabeurt = true;
                        state.currentPlayer = 2;
                        state.isFirstPlayerInRound = false;
                        
                        // Reset input en update
                        state.currentInput = 0;
                        updateCurrentScoreDisplay();
                        document.querySelectorAll('.dynamic-needed').forEach(el => el.remove());
                        updateSideScoreDisplays(); // UPDATE SIDE SCORES
                        updateScoringPage();
                        return;
                    } else {
                        // Speler 2 bereikt target eerst -> Match eindigt direct
                        endMatch();
                        return;
                    }
                }
                
                // Als dit een nabeurt is, eindig de match na deze beurt
                if (state.isNabeurt) {
                    endMatch();
                    return;
                }
                
                // Normale beurtwisseling (geen target bereikt)
                if (state.isFirstPlayerInRound) {
                    state.currentPlayer = 2;
                    state.isFirstPlayerInRound = false;
                } else {
                    state.currentPlayer = 1;
                    state.isFirstPlayerInRound = true;
                    state.turnNumber++;
                }
                
                // Reset en update
                state.currentInput = 0;
                updateCurrentScoreDisplay();
                document.querySelectorAll('.dynamic-needed').forEach(el => el.remove());
                updateSideScoreDisplays(); // UPDATE SIDE SCORES
                updateScoringPage();
            }

            function endMatch() {
                state.matchEnded = true;
                state.currentMatch.completed = true;
                
                const originalP1 = state.currentMatch.originalP1;
                const originalP2 = state.currentMatch.originalP2;
                
                let winner;
                let winnaarInfo = '';
                
                if (state.currentMatch.whitePlayer === 1) {
                    // Geen wisseling: speler 1 speelde met wit
                    if (state.firstToTarget === 1) {
                        winner = originalP1;
                        winnaarInfo = `${originalP1} bereikte als eerste zijn target. ${originalP2} kreeg nog n nabeurt.`;
                    } else if (state.firstToTarget === 2) {
                        winner = originalP2;
                        winnaarInfo = `${originalP2} bereikte als eerste zijn target. ${originalP1} kreeg geen nabeurt.`;
                    }
                    
                    state.currentMatch.p1Score = state.player1.score;
                    state.currentMatch.p2Score = state.player2.score;
                    
                    state.currentMatch.p1Turns = [...state.player1.turns];
                    state.currentMatch.p2Turns = [...state.player2.turns];
                    state.currentMatch.p1Highest = state.player1.highestSeries;
                    state.currentMatch.p2Highest = state.player2.highestSeries;
                } else {
                    // WEL wisseling: speler 2 speelde met wit
                    if (state.firstToTarget === 1) {
                        winner = originalP2;
                        winnaarInfo = `${originalP2} bereikte als eerste zijn target. ${originalP1} kreeg nog n nabeurt.`;
                    } else if (state.firstToTarget === 2) {
                        winner = originalP1;
                        winnaarInfo = `${originalP1} bereikte als eerste zijn target. ${originalP2} kreeg geen nabeurt.`;
                    }
                    
                    state.currentMatch.p1Score = state.player2.score;
                    state.currentMatch.p2Score = state.player1.score;
                    
                    state.currentMatch.p1Turns = [...state.player2.turns];
                    state.currentMatch.p2Turns = [...state.player1.turns];
                    state.currentMatch.p1Highest = state.player2.highestSeries;
                    state.currentMatch.p2Highest = state.player1.highestSeries;
                }
                
                state.currentMatch.winner = winner;
                
                saveStateToStorage();
                
                const matchEndedAlert = document.getElementById('matchEndedAlert');
                if (matchEndedAlert) {
                    matchEndedAlert.style.display = 'block';
                    matchEndedAlert.innerHTML = `
                         MATCH AFGELOPEN!<br>
                         WINNAAR: ${winner}<br>
                        <small>${winnaarInfo}</small>
                    `;
                }
                
                // SCHAKEL DE SCORE KNOPPEN UIT
                disableScoreButtons();
                
                document.querySelectorAll('.dynamic-needed').forEach(el => el.remove());
                updateScoringPage();
            }

            function updateScoringPage() {
                const player1Card = document.getElementById('player1Card');
                const player2Card = document.getElementById('player2Card');
                const headerDiv = document.querySelector('#page5 .header div:first-child');
                const totalTurns = state.player1.turns.length + state.player2.turns.length;
                
                if (state.matchEnded || totalTurns === 0) {
                    headerDiv.style.display = 'block';  // Toon knoppen
                } else {
                    headerDiv.style.display = 'none';   // Verberg knoppen
                }
                
                const currentName = state.currentPlayer === 1 ? state.currentMatch.p1 : state.currentMatch.p2;
                const btnNameElement = document.getElementById('currentPlayerBtnName');
                if (btnNameElement) {
                    btnNameElement.textContent = currentName;
                }
                
                player1Card.className = state.player1.isWhite ? 
                    'player-card player-white' : 'player-card player-yellow';
                player2Card.className = state.player2.isWhite ? 
                    'player-card player-white' : 'player-card player-yellow';
                
                if (state.currentPlayer === 1) {
                    player1Card.classList.add('player-active');
                    player2Card.classList.add('player-inactive');
                } else {
                    player1Card.classList.add('player-inactive');
                    player2Card.classList.add('player-active');
                }

                updateCurrentTurnSize();
                
                const avg1 = state.player1.turns.length > 0 ? 
                    (state.player1.score / state.player1.turns.length).toFixed(2) : '0.00';
                const avg2 = state.player2.turns.length > 0 ? 
                    (state.player2.score / state.player2.turns.length).toFixed(2) : '0.00';
                const needed1 = Math.max(0, state.player1.target - state.player1.score);
                const needed2 = Math.max(0, state.player2.target - state.player2.score);
                
                const player1TurnsReversed = [...state.player1.turns].reverse();
                const player2TurnsReversed = [...state.player2.turns].reverse();
                
                player1Card.innerHTML = `
                    <div>
                        <h3>${state.currentMatch.p1} ${state.player1.isWhite ? '' : ''}</h3>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-icon"></div>
                                <div>Doel:</div>
                                <div class="stat-value">${state.player1.target}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon"></div>
                                <div>Huidig:</div>
                                <div class="stat-value">${state.player1.score}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon"></div>
                                <div>Beurten:</div>
                                <div class="stat-value">${state.player1.turns.length}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon"></div>
                                <div>Gemiddelde:</div>
                                <div class="stat-value">${avg1}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon"></div>
                                <div>Nog nodig:</div>
                                <div class="stat-value">${needed1}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon"></div>
                                <div>Hoogste reeks:</div>
                                <div class="stat-value">${state.player1.highestSeries}</div>
                            </div>
                        </div>
                    </div>
                    <div class="turns-scroll-container">
                        <div class="turns-list">
                            ${player1TurnsReversed.map((turn, index) => {
                                const beurtNummer = state.player1.turns.length - index;
                                return `
                                    <div class="turn-row">
                                        <span>Beurt ${beurtNummer}:</span>
                                        <span>${turn} punt${turn !== 1 ? 'en' : ''}</span>
                                    </div>
                                `;
                            }).join('')}
                            ${state.player1.turns.length === 0 ? 
                                '<div style="text-align: center; color: #666; padding: 10px; font-size: 0.9em;">Geen beurten</div>' : 
                                ''}
                        </div>
                    </div>
                `;
                
                player2Card.innerHTML = `
                    <div>
                        <h3>${state.currentMatch.p2} ${state.player2.isWhite ? '' : ''}</h3>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-icon"></div>
                                <div>Doel:</div>
                                <div class="stat-value">${state.player2.target}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon"></div>
                                <div>Huidig:</div>
                                <div class="stat-value">${state.player2.score}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon"></div>
                                <div>Beurten:</div>
                                <div class="stat-value">${state.player2.turns.length}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon"></div>
                                <div>Gemiddelde:</div>
                                <div class="stat-value">${avg2}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon"></div>
                                <div>Nog nodig:</div>
                                <div class="stat-value">${needed2}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon"></div>
                                <div>Hoogste reeks:</div>
                                <div class="stat-value">${state.player2.highestSeries}</div>
                            </div>
                        </div>
                    </div>
                    <div class="turns-scroll-container">
                        <div class="turns-list">
                            ${player2TurnsReversed.map((turn, index) => {
                                const beurtNummer = state.player2.turns.length - index;
                                return `
                                    <div class="turn-row">
                                        <span>Beurt ${beurtNummer}:</span>
                                        <span>${turn} punt${turn !== 1 ? 'en' : ''}</span>
                                    </div>
                                `;
                            }).join('')}
                            ${state.player2.turns.length === 0 ? 
                                '<div style="text-align: center; color: #666; padding: 10px; font-size: 0.9em;">Geen beurten</div>' : 
                                ''}
                        </div>
                    </div>
                `;
                
                const currentColor = (state.currentPlayer === 1 && state.player1.isWhite) || 
                                   (state.currentPlayer === 2 && state.player2.isWhite) ? 'Wit' : 'Geel';
                const currentBeurtNummer = state.currentPlayer === 1 ? state.player1.beurtNummer : state.player2.beurtNummer;
                
                let turnInfo = `<div style="font-weight: bold; margin-bottom: 8px; font-size: 1.1em;">
                    Beurt ${currentBeurtNummer} voor ${currentName}
                </div>`;
                
                // Voeg specifieke informatie toe over de matchstatus
                if (state.isNabeurt) {
                    turnInfo += `<div style="margin-top: 10px; color: #27ae60; font-size: 0.9em; font-weight: bold;">
                         NABEURT! Speler 1 heeft al gewonnen. Dit is de laatste beurt voor Speler 2.
                    </div>`;
                } else if (state.firstToTarget === 1) {
                    turnInfo += `<div style="margin-top: 10px; color: #27ae60; font-size: 0.9em; font-weight: bold;">
                         Speler 1 heeft target bereikt! Dit is een nabeurt voor Speler 2.
                    </div>`;
                }
                
                document.getElementById('currentPlayerDisplay').innerHTML = `
                    ${turnInfo}
                    <div style="margin: 8px 0;">
                        <span style="background: ${currentColor === 'Wit' ? 'white' : '#f1c40f'}; 
                                  color: ${currentColor === 'Wit' ? 'black' : 'black'}; 
                                  padding: 6px 15px; 
                                  border-radius: 20px; 
                                  font-size: 0.9em;
                                  font-weight: bold;">
                            ${currentColor}
                        </span>
                    </div>
                `;
                
                // UPDATE DE SIDE SCORE DISPLAYS
                updateSideScoreDisplays();
                
                updateCurrentScoreDisplay();
                updateDynamicNeededDisplay();
            }

	    // EENVOUDIGE SPELERS PARSER (met kopteksten)
	    // FUNCTIE OM SPECIALE TEKENS TE REPAREREN
function fixEncoding(text) {
    if (!text) return '';
    
    // Vervang foute karakters
    const replacements = {
        '': '', '': '', '': '', '': '',
        '': '', '': '', '': '', '': '',
        '': '', '': '', '': '', '': '',
        '': '', '': '', '': '', '': '',
        '': '', '': '', '': ''
    };
    
    let fixed = text.toString();
    Object.keys(replacements).forEach(bad => {
        const regex = new RegExp(bad, 'g');
        fixed = fixed.replace(regex, replacements[bad]);
    });
    
    return fixed;
}


	    
	    // EENVOUDIGE SPEELDAGEN PARSER (met kopteksten)
	    function parseSpeeldagenCSVMetKopteksten(csvText) {
	        const lines = csvText.split(/\r\n|\n/);
	        const speeldagen = [];
    
	        // Start bij rij 1 (skip koptekst)
	        for (let i = 1; i < lines.length; i++) {
	            const line = lines[i].trim();
	            if (!line) continue;
        
	            const parts = line.split(';');
        
	            // 2 kolommen: VolgnummerSpeeldag en ExcelDatum
	            if (parts.length >= 2 && parts[0] && parts[1]) {
	                const volgnummer = parts[0].trim();
	                const excelDatum = parts[1].trim();
            
	                if (volgnummer && excelDatum && !isNaN(parseInt(excelDatum))) {
	                    const jsDatum = excelDatumNaarDatum(excelDatum);
                
	                    speeldagen.push({
	                        volgnummer: parseInt(volgnummer),
	                        excelDatum: parseInt(excelDatum),
	                        jsDatum: jsDatum,
	                        displayDatum: formatDateForInput(jsDatum),
                            fullDate: formatDateFull(formatDateForInput(jsDatum))
	                    });
	                }
	            }
	        }
    
	        // Sorteer op volgnummer
	        speeldagen.sort((a, b) => a.volgnummer - b.volgnummer);
	        
	        return speeldagen;
	    }
	    
	    function excelDatumNaarDatum(excelNummer) {
			// Excel telt vanaf 30 december 1899 (maar heeft een bug: 29 feb 1900 bestaat niet)
  			const dagen = parseInt(excelNummer);
  			if (isNaN(dagen)) return null;

  			// Basisdatum: 30 december 1899 (lokaal!)
  			const basis = new Date(1899, 11, 30); // December = maand 11 in JS

  			// Excel heeft een foute schrikkeljaardag in 1900  corrigeer na 29 feb 1900
  			const offset = dagen >= 60 ? -1 : 0;

  			// Bereken nieuwe datum LOKAAL (niet UTC!)
  			const nieuweDatum = new Date(basis.getTime() + (dagen + offset) * 24 * 60 * 60 * 1000);

  			// Zorg dat het middernacht blijft in lokale tijd
  			nieuweDatum.setHours(12, 0, 0, 0); // Middag om DST-problemen te vermijden

  			return nieuweDatum;
		}

            // ==================== LAAD SPELERS VAN GITHUB ====================
            async function loadPlayersFromGitHub() {
                try {
                    console.log(' Laad spelers van GitHub...');
                    
                    // Cache-busting URL
                    const cacheBuster = new Date().getTime();
                    const url = `https://raw.githubusercontent.com/Angello8647/biljart-app/main/spelers.json?v=${cacheBuster}`;
                    
                    const response = await fetch(url);
                    
                    if (!response.ok) {
                        console.log(' GitHub spelers niet gevonden, gebruik lokale spelers');
                        return false;
                    }
                    
                    const playersFromGitHub = await response.json();
                    
                    if (!Array.isArray(playersFromGitHub)) {
                        console.log(' Ongeldig formaat in spelers.json');
                        return false;
                    }
                    
                    console.log(` ${playersFromGitHub.length} spelers geladen van GitHub`);
                    
                    // VERVANG lokale spelers met GitHub spelers
                    state.players = playersFromGitHub;
                    
                    // Sorteer op naam
                    state.players.sort((a, b) => a.name.localeCompare(b.name));
                    
                    // Sla op in localStorage voor offline gebruik
                    savePlayersToStorage();
                    
                    return true;
                    
                } catch (error) {
                    console.log(' Fout bij laden van GitHub:', error.message);
                    return false;
                }
            }

            window.refreshPlayersFromGitHub = async function() {
                if (confirm('Spelers herladen van GitHub?\n\nLokale wijzigingen gaan verloren.')) {
                    const success = await loadPlayersFromGitHub();
                    
                    if (success) {
                        alert(` ${state.players.length} spelers geladen van GitHub!`);
                        // Herlaad de spelers tab
                        if (state.currentMatchesTab === 'players') {
                            loadPlayersManagementTab();
                        }
                    } else {
                        alert(' Kon spelers niet laden van GitHub. Controleer internet of het bestand.');
                    }
                }
            }

            // ==================== SPELERS BEHEER FUNCTIES ====================
            window.showMatchesTab = function(tab) {
                state.currentMatchesTab = tab;
                
                document.querySelectorAll('#matchesTabs .tab-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                document.querySelectorAll('#matchesTabContent .tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                
                document.getElementById(`tab${tab.charAt(0).toUpperCase() + tab.slice(1)}`).classList.add('active');
                document.getElementById(`tabContent${tab.charAt(0).toUpperCase() + tab.slice(1)}`).classList.add('active');
                
                if (tab === 'players') {
                    loadPlayersManagementTab();
                } else if (tab === 'speeldagen') {
                    loadSpeeldagenManagementTab();
                } else {
                    loadMatchesTabContent();
                }
            }

           function loadPlayersManagementTab() {
    const container = document.getElementById('tabContentPlayers');
    
    updatePlayersBadge();
    
    // Zorg dat spelers geladen zijn
    if (!state.players || state.players.length === 0) {
        console.log(" Geen spelers gevonden in state, probeer te laden...");
        const savedPlayers = localStorage.getItem('biljartPlayers');
        if (savedPlayers) {
            try {
                state.players = JSON.parse(savedPlayers);
                console.log(` ${state.players.length} spelers geladen uit localStorage`);
            } catch (e) {
                console.error(" Fout bij laden spelers:", e);
                state.players = [];
            }
        }
    }
    
    const totalPlayers = state.players.length;
    const avgTsg = totalPlayers > 0 
        ? (state.players.reduce((sum, p) => sum + (parseFloat(p.tsg.replace(',', '.')) || 0), 0) / totalPlayers).toFixed(3)
        : '0.000';
    const avgTarget = totalPlayers > 0 
        ? Math.round(state.players.reduce((sum, p) => sum + (p.target || 0), 0) / totalPlayers)
        : 0;
    
    container.innerHTML = `
        <div class="players-management-container">
            <!-- GitHub info sectie -->
            <div style="background: #2c3e50; border-left: 4px solid #9b59b6; padding: 15px; margin-bottom: 20px; border-radius: 8px;">
                <h4> GitHub Spelers</h4>
                <p style="color: #bdc3c7; font-size: 0.9em; margin: 5px 0;">
                    Spelers worden geladen van GitHub bij opstarten.
                </p>
                <div style="display: flex; gap: 10px; margin-top: 10px;">
                    <button onclick="refreshPlayersFromGitHub()" 
                            style="background: #9b59b6; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer;">
                         Herlaad van GitHub
                    </button>
                    <a href="https://github.com/Angello8647/biljart-app/edit/main/spelers.json" 
                       target="_blank"
                       style="background: #3498db; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; text-decoration: none;">
                         Bewerk op GitHub
                    </a>
                </div>
            </div>
            
            <!-- Formulier voor nieuwe speler -->
            <div class="player-form-container">
                <h3>${editingPlayerIndex >= 0 ? ' Speler Bewerken' : ' Nieuwe Speler Toevoegen'}</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>Naam *</label>
                        <input type="text" id="playerNameInput" class="form-input" 
                               placeholder="Voor- en achternaam" 
                               value="${editingPlayerData ? editingPlayerData.name : ''}">
                    </div>
                    <div class="form-group">
                        <label>Gemiddelde (TSG)</label>
                        <input type="text" id="playerTsgInput" class="form-input" 
                               placeholder="bijv. 4,864" 
                               value="${editingPlayerData ? editingPlayerData.tsg : ''}">
                    </div>
                    <div class="form-group">
                        <label>Target</label>
                        <input type="number" id="playerTargetInput" class="form-input" 
                               placeholder="bijv. 87" min="1" max="200"
                               value="${editingPlayerData ? editingPlayerData.target : ''}">
                    </div>
                    <button class="add-player-btn" onclick="${editingPlayerIndex >= 0 ? 'saveEditedPlayer()' : 'addNewPlayer()'}">
                        ${editingPlayerIndex >= 0 ? ' Opslaan' : ' Toevoegen'}
                    </button>
                </div>
                ${editingPlayerIndex >= 0 ? 
                    `<button class="cancel-btn" onclick="cancelEditPlayer()" style="margin-top: 10px;"> Annuleren</button>` : 
                    ''}
            </div>
            
            <!-- IMPORT/EXPORT KNOBBEN -->
            <div style="background: #34495e; border-radius: 10px; padding: 20px; margin: 20px 0; border-left: 4px solid #2ecc71;">
                <h4 style="margin-bottom: 15px; color: #2ecc71;"> Import/Export</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                    <button onclick="importPlayersFromCSV()" 
                            style="background: #2ecc71; color: white; padding: 12px; border-radius: 6px; border: none; cursor: pointer; font-size: 14px;">
                         Importeer Spelers CSV
                    </button>
                    <button onclick="importSpeeldagenCSV()" 
                            style="background: #3498db; color: white; padding: 12px; border-radius: 6px; border: none; cursor: pointer; font-size: 14px;">
                         Importeer Speeldagen CSV
                    </button>
                    <button onclick="exportPlayersToCSV()" 
                            style="background: #9b59b6; color: white; padding: 12px; border-radius: 6px; border: none; cursor: pointer; font-size: 14px;">
                         Exporteer Spelers naar CSV
                    </button>
                    <button onclick="exportSpelersNaarCSV()" 
                            style="background: #e67e22; color: white; padding: 12px; border-radius: 6px; border: none; cursor: pointer; font-size: 14px;">
                         Exporteer Volledige Spelers
                    </button>
                </div>
                <p style="color: #bdc3c7; font-size: 0.9em; margin-top: 15px;">
                    <small> Gebruik CSV import om spelers en speeldagen te laden vanuit Excel/Google Sheets</small>
                </p>
            </div>
            
            <!-- Statistieken overzicht -->
            <div class="stats-summary">
                <div class="stats-item">
                    <div>Totaal spelers</div>
                    <div class="stats-value">${totalPlayers}</div>
                </div>
                <div class="stats-item">
                    <div>Gemiddeld TSG</div>
                    <div class="stats-value">${avgTsg.replace('.', ',')}</div>
                </div>
                <div class="stats-item">
                    <div>Gemiddeld target</div>
                    <div class="stats-value">${avgTarget}</div>
                </div>
            </div>
            
            <!-- SPELERSLIJST -->
            <div class="players-list-container">
                <h3 style="margin-bottom: 20px;"> Alle Spelers (${totalPlayers})</h3>
                
                <!-- Zoek en bulk acties -->
                <div style="margin-bottom: 20px; display: flex; flex-wrap: wrap; gap: 10px; align-items: center;">
                    <div style="flex-grow: 1;">
                        <input type="text" id="playerSearchInput" class="search-input" 
                               placeholder="Zoek speler op naam, TSG of target..." 
                               onkeyup="filterPlayersList()">
                    </div>
                    <button class="bulk-action-btn" onclick="clearAllPlayers()" style="background: #e74c3c;">
                         Alle Spelers Verwijderen
                    </button>
                </div>
                
                <!-- HEADER -->
                <div class="players-list-header">
                    <div>Naam</div>
                    <div>TSG Gemiddelde</div>
                    <div>Target</div>
                    <div>Acties</div>
                </div>
                
                <!-- SPELERS CONTENT -->
                <div id="playersListContent">
                    ${totalPlayers === 0 ? 
                        '<div class="empty-players-message">Geen spelers gevonden. Voeg spelers toe via het formulier of importeer een CSV.</div>' : 
                        ''}
                </div>
            </div>
            
            <!-- Gemporteerde Data Info -->
            ${(state.speeldagen && state.speeldagen.length > 0) ? `
                <div style="background: #2c3e50; padding: 15px; border-radius: 8px; margin-top: 30px;">
                    <h4> Gemporteerde Speeldagen (${state.speeldagen.length})</h4>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;">
                        ${state.speeldagen.slice(0, 8).map(dag => `
                            <span style="background: #34495e; padding: 5px 10px; border-radius: 4px; font-size: 0.8em;">
                                Speeldag ${dag.volgnummer}: ${dag.displayDatum}
                            </span>
                        `).join('')}
                        ${state.speeldagen.length > 8 ? 
                            `<span style="color: #95a5a6; align-self: center;">... en ${state.speeldagen.length - 8} meer</span>` : 
                            ''}
                    </div>
                </div>
            ` : ''}
        </div>
    `;
    
    if (totalPlayers > 0) {
        renderPlayersList();
    }
}
           function renderPlayersList() {
    const container = document.getElementById('playersListContent');
    if (!container) return;
    
    // Zoekterm ophalen
    const searchInput = document.getElementById('playerSearchInput');
    const searchTerm = searchInput ? searchInput.value.toLowerCase() : '';
    
    // Filter spelers op zoekterm
    const filteredPlayers = state.players.filter(player => {
        if (!player || !player.name) return false;
        
        const naam = (player.name || '').toString().toLowerCase();
        const tsg = (player.tsg || '').toString().toLowerCase();
        const target = (player.target || '').toString();
        
        return naam.includes(searchTerm) ||
               tsg.includes(searchTerm) ||
               target.includes(searchTerm);
    });
    
    // Toon gefilterde spelers of "geen resultaten" bericht
    if (filteredPlayers.length === 0) {
        container.innerHTML = `
            <div class="empty-players-message">
                ${searchTerm ? 
                    `Geen spelers gevonden voor "${searchTerm}"` : 
                    'Geen spelers gevonden'}
            </div>
        `;
        return;
    }
    
    // Bouw de spelerslijst op
    container.innerHTML = filteredPlayers.map((player, index) => {
        const isEditing = editingPlayerIndex === index;
        
        return `
            <div class="player-row ${isEditing ? 'editing' : ''}" id="playerRow_${index}">
                <div>
                    ${isEditing ? 
                        `<input type="text" class="editable-input" id="editName_${index}" value="${player.name || ''}">` : 
                        `<strong>${player.name || 'Naam onbekend'}</strong>`}
                </div>
                <div>
                    ${isEditing ? 
                        `<input type="text" class="editable-input" id="editTsg_${index}" value="${player.tsg || ''}">` : 
                        player.tsg || '0,000'}
                </div>
                <div>
                    ${isEditing ? 
                        `<input type="number" class="editable-input" id="editTarget_${index}" value="${player.target || ''}" min="1" max="200">` : 
                        player.target || '0'}
                </div>
                <div class="player-actions">
                    ${isEditing ? `
                        <button class="save-btn" onclick="savePlayerEdit(${index})"> Opslaan</button>
                        <button class="cancel-btn" onclick="cancelEditPlayer()"> Annuleren</button>
                    ` : `
                        <button class="edit-btn" onclick="editPlayer(${index})"> Bewerk</button>
                        <button class="delete-btn" onclick="deletePlayer(${index})"> Verwijder</button>
                    `}
                </div>
            </div>
        `;
    }).join('');
}

            window.filterPlayersList = function() {
                renderPlayersList();
            }

            window.addNewPlayer = function() {
                const nameInput = document.getElementById('playerNameInput');
                const tsgInput = document.getElementById('playerTsgInput');
                const targetInput = document.getElementById('playerTargetInput');
                
                const name = nameInput.value.trim();
                const tsg = tsgInput.value.trim() || '0,000';
                const target = parseInt(targetInput.value) || 0;
                
                if (!name) {
                    alert('Voer een naam in voor de speler');
                    nameInput.focus();
                    return;
                }
                
                // Check voor dubbele naam
                const existingPlayer = state.players.find(p => 
                    p.name.toLowerCase() === name.toLowerCase()
                );
                
                if (existingPlayer) {
                    if (!confirm(`Speler "${name}" bestaat al. Toch toevoegen?`)) {
                        return;
                    }
                }
                
                // Parse TSG correct
                const cleanTsg = tsg.replace(',', '.');
                const tsgValue = parseFloat(cleanTsg) || 0;
                const formattedTsg = tsgValue.toFixed(3).replace('.', ',');
                
                // Validate target
                const validTarget = Math.max(1, Math.min(200, target || 50));
                
                // Add player
                state.players.push({
                    name: name,
                    tsg: formattedTsg,
                    target: validTarget
                });
                
                // Save to storage
                savePlayersToStorage();
                
                // Clear form
                nameInput.value = '';
                tsgInput.value = '';
                targetInput.value = '';
                
                // Refresh display
                renderPlayersList();
                updatePlayersBadge();
                
                alert(` Speler "${name}" toegevoegd!`);
                nameInput.focus();
            }

            window.editPlayer = function(index) {
                if (index < 0 || index >= state.players.length) return;
                
                editingPlayerIndex = index;
                editingPlayerData = { ...state.players[index] };
                loadPlayersManagementTab();
            }

            window.saveEditedPlayer = function() {
                if (editingPlayerIndex < 0 || !editingPlayerData) return;
                
                const nameInput = document.getElementById('playerNameInput');
                const tsgInput = document.getElementById('playerTsgInput');
                const targetInput = document.getElementById('playerTargetInput');
                
                const newName = nameInput.value.trim();
                const newTsg = tsgInput.value.trim() || '0,000';
                const newTarget = parseInt(targetInput.value) || 0;
                
                if (!newName) {
                    alert('Voer een naam in voor de speler');
                    nameInput.focus();
                    return;
                }
                
                // Check for duplicate name (excluding current player)
                const existingPlayer = state.players.find((p, idx) => 
                    idx !== editingPlayerIndex && 
                    p.name.toLowerCase() === newName.toLowerCase()
                );
                
                if (existingPlayer) {
                    alert(`Speler "${newName}" bestaat al. Kies een andere naam.`);
                    return;
                }
                
                // Parse TSG
                const cleanTsg = newTsg.replace(',', '.');
                const tsgValue = parseFloat(cleanTsg) || 0;
                const formattedTsg = tsgValue.toFixed(3).replace('.', ',');
                
                // Validate target
                const validTarget = Math.max(1, Math.min(200, newTarget || 50));
                
                // Update player
                state.players[editingPlayerIndex] = {
                    name: newName,
                    tsg: formattedTsg,
                    target: validTarget
                };
                
                // Save to storage
                savePlayersToStorage();
                
                // Reset editing state
                editingPlayerIndex = -1;
                editingPlayerData = null;
                
                // Refresh display
                loadPlayersManagementTab();
                
                alert(` Speler "${newName}" bijgewerkt!`);
            }

            window.savePlayerEdit = function(index) {
                if (index < 0 || index >= state.players.length) return;
                
                const nameInput = document.getElementById(`editName_${index}`);
                const tsgInput = document.getElementById(`editTsg_${index}`);
                const targetInput = document.getElementById(`editTarget_${index}`);
                
                const newName = nameInput.value.trim();
                const newTsg = tsgInput.value.trim() || '0,000';
                const newTarget = parseInt(targetInput.value) || 0;
                
                if (!newName) {
                    alert('Voer een naam in voor de speler');
                    nameInput.focus();
                    return;
                }
                
                // Check for duplicate name
                const existingPlayer = state.players.find((p, idx) => 
                    idx !== index && 
                    p.name.toLowerCase() === newName.toLowerCase()
                );
                
                if (existingPlayer) {
                    alert(`Speler "${newName}" bestaat al. Kies een andere naam.`);
                    return;
                }
                
                // Parse TSG
                const cleanTsg = newTsg.replace(',', '.');
                const tsgValue = parseFloat(cleanTsg) || 0;
                const formattedTsg = tsgValue.toFixed(3).replace('.', ',');
                
                // Validate target
                const validTarget = Math.max(1, Math.min(200, newTarget || 50));
                
                // Update player
                state.players[index] = {
                    name: newName,
                    tsg: formattedTsg,
                    target: validTarget
                };
                
                // Save to storage
                savePlayersToStorage();
                
                // Reset editing state
                editingPlayerIndex = -1;
                editingPlayerData = null;
                
                // Refresh display
                renderPlayersList();
                
                alert(` Speler "${newName}" bijgewerkt!`);
            }

            window.cancelEditPlayer = function() {
                editingPlayerIndex = -1;
                editingPlayerData = null;
                loadPlayersManagementTab();
            }

            window.deletePlayer = function(index) {
                if (index < 0 || index >= state.players.length) return;
                
                const player = state.players[index];
                
                if (!confirm(`Weet je zeker dat je "${player.name}" wilt verwijderen?\n\nDit kan niet ongedaan gemaakt worden.`)) {
                    return;
                }
                
                // Check if player is in any active matches
                const activeMatches = state.matches.filter(m => !m.completed);
                const playerInMatch = activeMatches.find(m => 
                    m.p1 === player.name || m.p2 === player.name
                );
                
                if (playerInMatch) {
                    alert(` Waarschuwing: "${player.name}" speelt in een actieve match.\nVerwijder eerst de match of wijzig de spelers.`);
                    return;
                }
                
                // Remove player
                state.players.splice(index, 1);
                
                // Save to storage
                savePlayersToStorage();
                
                // Refresh display
                if (state.currentMatchesTab === 'players') {
                    renderPlayersList();
                    updatePlayersBadge();
                }
                
                alert(` Speler "${player.name}" verwijderd!`);
            }

            function updatePlayersBadge() {
                const badge = document.getElementById('badgePlayers');
                if (badge) {
                    badge.textContent = state.players.length;
                }
            }

            window.exportPlayersToCSV = function() {
                if (state.players.length === 0) {
                    alert('Geen spelers om te exporteren.');
                    return;
                }
                
                let csvContent = "Naam;Gemiddelde;Target\n";
                
                state.players.forEach(player => {
                    csvContent += `${player.name};${player.tsg};${player.target}\n`;
                });
                
                const blob = new Blob(["\uFEFF" + csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement("a");
                const url = URL.createObjectURL(blob);
                link.setAttribute("href", url);
                link.setAttribute("download", `biljart_spelers_${new Date().toISOString().split('T')[0]}.csv`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                alert(` ${state.players.length} spelers gexporteerd naar CSV!`);
            }

            // VERVANG de bestaande importPlayersFromCSV functie:
	    // NIEUWE import functie voor spelers CSV (met kopteksten)
window.importPlayersFromCSV = function() {
    const fileInput = document.createElement('input');
    fileInput.type = 'file';
    fileInput.accept = '.csv';
    
    fileInput.onchange = function(event) {
        const file = event.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                console.log("=== IMPORTEER SPELERS CSV (met kopteksten) ===");
                const csvText = e.target.result;
                
                // Parse spelers data MET kopteksten
                const nieuweSpelers = parseSpelersCSVMetKopteksten(csvText);
                
                if (nieuweSpelers.length === 0) {
                    alert("Geen spelers gevonden in CSV!");
                    return;
                }
                
                // Toon voorbeeld van wat er gemporteerd wordt
                let voorbeeld = "Voorbeeld van te importeren spelers:\n\n";
                nieuweSpelers.slice(0, 3).forEach((speler, i) => {
                    voorbeeld += `${i+1}. ${speler.naam} (Target: ${speler.target}, TSG: ${speler.tsg})\n`;
                });
                if (nieuweSpelers.length > 3) {
                    voorbeeld += `... en ${nieuweSpelers.length - 3} meer\n`;
                }
                
                if (!confirm(`${nieuweSpelers.length} spelers gevonden.\n\n${voorbeeld}\nBestaande spelers worden bijgewerkt (TSG, Target).\nNieuwe spelers worden toegevoegd.\n\nDoorgaan?`)) {
                    return;
                }
                
                // Merge met bestaande spelers
                const huidigeSpelers = state.players || [];
                const gemergedSpelers = [...huidigeSpelers];
                
                let bijgewerkt = 0;
                let toegevoegd = 0;
                
                nieuweSpelers.forEach(nieuweSpeler => {
                    const bestaandeIndex = gemergedSpelers.findIndex(p => 
                        p.naam && nieuweSpeler.naam && 
                        p.naam.toLowerCase() === nieuweSpeler.naam.toLowerCase()
                    );
                    
                    if (bestaandeIndex >= 0) {
                        // Update TSG en Target van BESTAANDE speler
                        gemergedSpelers[bestaandeIndex].tsg = nieuweSpeler.tsg;
                        gemergedSpelers[bestaandeIndex].target = nieuweSpeler.target;
                        bijgewerkt++;
                        console.log(` Speler bijgewerkt: ${nieuweSpeler.naam}`);
                    } else {
                        // Nieuwe speler toevoegen
                        gemergedSpelers.push(nieuweSpeler);
                        toegevoegd++;
                        console.log(` Nieuwe speler: ${nieuweSpeler.naam}`);
                    }
                });
                
                // Update state
                state.players = gemergedSpelers;
                
                // Opslaan
                localStorage.setItem('biljartPlayers', JSON.stringify(gemergedSpelers));
                
                // Refresh UI
                if (state.currentMatchesTab === 'players') {
                    loadPlayersManagementTab();
                }
                
                // Toon resultaat
                let resultMessage = ` Spelers import voltooid!\n\n`;
                resultMessage += `Bijgewerkt: ${bijgewerkt} spelers\n`;
                resultMessage += `Toegevoegd: ${toegevoegd} nieuwe spelers\n`;
                resultMessage += `Totaal: ${gemergedSpelers.length} spelers`;
                
                alert(resultMessage);
                
            } catch (error) {
                console.error("Import fout:", error);
                alert(` Fout bij importeren: ${error.message}\n\nControleer of het CSV formaat klopt.`);
            }
        };
        
        reader.readAsText(file, 'UTF-8');
    };
    
    fileInput.click();
};

// FUNCTIE: Parse spelers CSV MET kopteksten
function parseSpelersCSVMetKopteksten(csvText) {
    console.log("=== PARSE SPELERS CSV MET KOPTEKSTEN ===");
    
    const lines = csvText.split(/\r\n|\n/);
    const spelers = [];
    
    // Skip eerste rij (kopteksten)
    for (let i = 1; i < lines.length; i++) {
        const line = lines[i].trim();
        if (!line) continue;
        
        const parts = line.split(';');
        
        // CSV kolommen: Volgnummer;Naam;Target;TSG;TargetEersteZes;TSGEersteZes
        if (parts.length >= 4) {
            const rawNaam = parts[1]?.trim();  // Eerst opslaan in variabele
if (!rawNaam) continue; // Skip als er geen naam is

const speler = {
    name: fixEncoding(rawNaam),   //  CORRECT
    naam: fixEncoding(rawNaam),   //  CORRECT
    tsg: parts[3] || '0,000',
    target: parseInt(parts[2]) || 50,
    // Optionele velden
    targetEersteZes: parts[4] ? parseInt(parts[4]) : null,
    tsgEersteZes: parts[5] || null
};
            
            if (speler.naam) {
                spelers.push(speler);
                console.log(` Speler geparsed: ${speler.naam} (Target: ${speler.target}, TSG: ${speler.tsg})`);
            }
        }
    }
    
    console.log(` ${spelers.length} spelers geparsed`);
    return spelers;
}
// FUNCTIE: Importeer alleen speeldagen CSV
window.importSpeeldagenCSV = function() {
    const fileInput = document.createElement('input');
    fileInput.type = 'file';
    fileInput.accept = '.csv';
    
    fileInput.onchange = function(event) {
        const file = event.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                console.log("=== IMPORTEER SPEELDAGEN CSV ===");
                const csvText = e.target.result;
                
                // Parse speeldagen data
                const speeldagen = parseSpeeldagenCSVMetKopteksten(csvText);
                
                if (speeldagen.length === 0) {
                    alert("Geen speeldagen gevonden in CSV!");
                    return;
                }
                
                // Toon voorbeeld
                let voorbeeld = "Speeldagen die worden gemporteerd:\n\n";
                speeldagen.slice(0, 5).forEach(dag => {
                    voorbeeld += `Speeldag ${dag.volgnummer}: ${dag.fullDate}\n`;
                });
                if (speeldagen.length > 5) {
                    voorbeeld += `... en ${speeldagen.length - 5} meer\n`;
                }
                
                if (!confirm(`${speeldagen.length} speeldagen gevonden.\n\n${voorbeeld}\n\nDoorgaan?`)) {
                    return;
                }
                
                // Update state
                state.speeldagen = speeldagen;
                localStorage.setItem('biljartSpeeldagen', JSON.stringify(speeldagen));
                
                // Optioneel: vraag seizoen
                if (confirm("Wil je ook het seizoen instellen?")) {
                    const seizoenStart = prompt("Voer startjaar seizoen in (bijv. 2024):");
                    const seizoenEind = prompt("Voer eindjaar seizoen in (bijv. 2025):");
                    
                    if (seizoenStart && seizoenEind) {
                        state.currentSeizoen = `${seizoenStart}-${seizoenEind}`;
                        localStorage.setItem('biljartCurrentSeizoen', state.currentSeizoen);
                    }
                }
                
                // Refresh UI
                if (state.currentMatchesTab === 'speeldagen') {
                    loadSpeeldagenManagementTab();
                }
                
                // Update badge
                updateSpeeldagenBadge();
                
                // Toon bevestiging
                let message = ` ${speeldagen.length} speeldagen gemporteerd!`;
                if (state.currentSeizoen) {
                    message += `\nSeizoen ingesteld op: ${state.currentSeizoen}`;
                }
                alert(message);
                
            } catch (error) {
                console.error("Speeldagen import fout:", error);
                alert(` Fout bij importeren speeldagen: ${error.message}`);
            }
        };
        
        reader.readAsText(file, 'UTF-8');
    };
    
    fileInput.click();
};

// FUNCTIE: Parse speeldagen CSV MET kopteksten
function parseSpeeldagenCSVMetKopteksten(csvText) {
    console.log("=== PARSE SPEELDAGEN CSV MET KOPTEKSTEN ===");
    
    const lines = csvText.split(/\r\n|\n/);
    const speeldagen = [];
    
    // Skip eerste rij (kopteksten)
    for (let i = 1; i < lines.length; i++) {
        const line = lines[i].trim();
        if (!line) continue;
        
        const parts = line.split(';');
        
        // CSV kolommen: VolgnummerSpeeldag;ExcelDatum
        if (parts.length >= 2) {
            const volgnummer = parts[0]?.trim();
            const excelDatum = parts[1]?.trim();
            
            // Controleer of het geldige data is
            if (volgnummer && excelDatum && !isNaN(parseInt(excelDatum))) {
                const jsDatum = excelDatumNaarDatum(excelDatum);
                
                speeldagen.push({
                    volgnummer: parseInt(volgnummer),
                    excelDatum: parseInt(excelDatum),
                    jsDatum: jsDatum,
                    displayDatum: formatDateForInput(jsDatum),
                    fullDate: formatDateFull(formatDateForInput(jsDatum))
                });
                
                console.log(` Speeldag geparsed: ${volgnummer} -> ${jsDatum}`);
            }
        }
    }
    
    // Sorteer op volgnummer
    speeldagen.sort((a, b) => a.volgnummer - b.volgnummer);
    
    console.log(` ${speeldagen.length} speeldagen geparsed`);
    return speeldagen;
}
            function parsePlayersCSV(csvText) {
                console.log("=== START PARSE PLAYERS CSV ===");
                
                // Fix encoding
                csvText = fixCSVEncoding(csvText);
                
                console.log("CSV lengte:", csvText.length);
                
                // Split in regels
                const lines = csvText.split(/\r\n|\n/);
                console.log("Aantal regels:", lines.length);
                
                let addedCount = 0;
                
                for (let i = 0; i < lines.length; i++) {
                    let line = lines[i].trim();
                    
                    // Skip lege regels
                    if (!line || line === '') {
                        continue;
                    }
                    
                    // Complexere CSV parsing die met aanhalingstekens om kan gaan
                    let parts = [];
                    let currentPart = '';
                    let inQuotes = false;
                    let quoteChar = '';
                    
                    for (let j = 0; j < line.length; j++) {
                        const char = line[j];
                        
                        if ((char === '"' || char === "'") && !inQuotes) {
                            inQuotes = true;
                            quoteChar = char;
                        } else if (char === quoteChar && inQuotes) {
                            inQuotes = false;
                        } else if (char === ';' && !inQuotes) {
                            parts.push(currentPart.trim());
                            currentPart = '';
                        } else {
                            currentPart += char;
                        }
                    }
                    
                    // Voeg het laatste deel toe
                    if (currentPart !== '') {
                        parts.push(currentPart.trim());
                    }
                    
                    // Als we geen puntenkomma's vinden, probeer dan standaard split
                    if (parts.length < 3) {
                        parts = line.split(';').map(p => p.trim());
                    }
                    
                    // Minimaal 3 velden nodig: Naam;Gemiddelde;Target
                    if (parts.length < 3) {
                        console.log(` Regel ${i + 1} heeft te weinig velden:`, line);
                        continue;
                    }
                    
                    try {
                        // Verwijder aanhalingstekens van alle velden
                        const playerName = normalizeText(parts[0])
                            .replace(/^["']+|["']+$/g, '')
                            .trim();
                        
                        const tsg = parts[1]
                            .replace(/^["']+|["']+$/g, '')
                            .trim();
                        
                        const target = parts[2]
                            .replace(/^["']+|["']+$/g, '')
                            .trim();
                        
                        // Parse getallen
                        const tsgValue = tsg ? tsg.replace(',', '.').replace(/[^0-9.-]/g, '') : '0';
                        const targetValue = parseInt(target.replace(/[^0-9]/g, '')) || 0;
                        
                        // Controleer of speler al bestaat
                        const playerExists = state.players.some(p => p.name === playerName);
                        if (playerExists) {
                            console.log(` Speler bestaat al: ${playerName}`);
                            continue;
                        }
                        
                        // Voeg speler toe
                        state.players.push({
                            name: playerName,
                            tsg: tsgValue,
                            target: targetValue
                        });
                        
                        addedCount++;
                        console.log(` Speler toegevoegd: "${playerName}" (gem: ${tsgValue}, target: ${targetValue})`);
                        
                    } catch (error) {
                        console.error(` Fout bij verwerken regel ${i + 1}:`, error, "Regel:", line);
                    }
                }

                console.log(` Totaal ${addedCount} nieuwe spelers toegevoegd`);
                savePlayersToStorage();
                return addedCount;
            }

            function normalizeText(text) {
                if (!text) return '';
                
                const replacements = {
                    '': '', '': '', '': '', '': '', '': '',
                    '': '', '': '', '': '', '': '', '': '',
                    '': '', '': '', '': '', '': '', '': '',
                    '': '', '': ''
                };
            
                let normalized = text.toString();
                
                Object.keys(replacements).forEach(bad => {
                    const regex = new RegExp(bad, 'g');
                    normalized = normalized.replace(regex, replacements[bad]);
                });
                
                return normalized;
            }

            function fixCSVEncoding(content) {
                const replacements = [
                    ['', ''], ['', ''], ['', ''], ['', ''], ['', ''],
                    ['', ''], ['', ''], ['', ''], ['', ''], ['', ''],
                    ['', ''], ['', ''], ['', ''], ['', ''], ['', ''],
                    ['', ''], ['', '']
                ];
            
                let fixedContent = content;
                
                replacements.forEach(([bad, good]) => {
                    const regex = new RegExp(bad, 'g');
                    fixedContent = fixedContent.replace(regex, good);
                });
                
                return fixedContent;
            }

            function savePlayersToStorage() {
                localStorage.setItem('biljartPlayers', JSON.stringify(state.players));
            }

            window.clearAllPlayers = function() {
                if (confirm("Weet je zeker dat je ALLE spelers wilt verwijderen? Dit kan niet ongedaan gemaakt worden!")) {
                    state.players = [];
                    savePlayersToStorage();
                    loadPlayersManagementTab();
                }
            }

            // ==================== NIEUWE FUNCTIES VOOR SPEELDAGEN BEHEER ====================
            function loadSpeeldagenManagementTab() {
                const container = document.getElementById('tabContentSpeeldagen');
                
                updateSpeeldagenBadge();
                
                // Zorg dat speeldagen geladen zijn
                if (!state.speeldagen || state.speeldagen.length === 0) {
                    console.log(" Geen speeldagen gevonden in state, probeer te laden...");
                    const savedSpeeldagen = localStorage.getItem('biljartSpeeldagen');
                    if (savedSpeeldagen) {
                        try {
                            state.speeldagen = JSON.parse(savedSpeeldagen);
                            console.log(` ${state.speeldagen.length} speeldagen geladen uit localStorage`);
                        } catch (e) {
                            console.error(" Fout bij laden speeldagen:", e);
                            state.speeldagen = [];
                        }
                    }
                }
                
                const totalSpeeldagen = state.speeldagen.length;
                
                container.innerHTML = `
                    <div class="speeldagen-management-container">
                        <!-- Import sectie -->
                        <div style="background: #2c3e50; border-left: 4px solid #e67e22; padding: 15px; margin-bottom: 20px; border-radius: 8px;">
                            <h4> Importeer Speeldagen</h4>
                            <p style="color: #bdc3c7; font-size: 0.9em; margin: 5px 0;">
                                Importeer speeldagen vanuit een CSV bestand met kolommen: VolgnummerSpeeldag;ExcelDatum
                            </p>
                            <div style="display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap;">
                                <button onclick="importSpeeldagenCSV()" 
                                        style="background: #e67e22; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer;">
                                     Importeer CSV
                                </button>
                                <button onclick="exportSpeeldagenToCSV()" 
                                        style="background: #3498db; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer;">
                                     Exporteer CSV
                                </button>
                            </div>
                        </div>
                        
                        <!-- Formulier voor nieuwe speeldag -->
                        <div class="speeldagen-form-container">
                            <h3> Nieuwe Speeldag Toevoegen</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Volgnummer *</label>
                                    <input type="number" id="speeldagVolgnummer" class="form-input" 
                                           placeholder="bijv. 1" min="1" max="100"
                                           value="${state.speeldagen.length > 0 ? Math.max(...state.speeldagen.map(s => s.volgnummer)) + 1 : 1}">
                                </div>
                                <div class="form-group">
                                    <label>Datum *</label>
                                    <input type="date" id="speeldagDatum" class="form-input" 
                                           value="${formatDateForInput(new Date())}">
                                </div>
                                <div class="form-group">
                                    <label>Excel Datum (optioneel)</label>
                                    <input type="number" id="speeldagExcelDatum" class="form-input" 
                                           placeholder="Excel datumnummer">
                                </div>
                                <button class="add-player-btn" onclick="addNewSpeeldag()" style="background: #e67e22;">
                                     Toevoegen
                                </button>
                            </div>
                        </div>
                        
                        <!-- Statistieken overzicht -->
                        <div class="stats-summary">
                            <div class="stats-item">
                                <div>Totaal speeldagen</div>
                                <div class="stats-value">${totalSpeeldagen}</div>
                            </div>
                            <div class="stats-item">
                                <div>Eerste speeldag</div>
                                <div class="stats-value">${totalSpeeldagen > 0 ? state.speeldagen[0].displayDatum : 'N/A'}</div>
                            </div>
                            <div class="stats-item">
                                <div>Laatste speeldag</div>
                                <div class="stats-value">${totalSpeeldagen > 0 ? state.speeldagen[state.speeldagen.length - 1].displayDatum : 'N/A'}</div>
                            </div>
                        </div>
                        
                        <!-- SPEELDAGENLIJST -->
                        <div class="speeldagen-list-container">
                            <h3 style="margin-bottom: 20px;"> Alle Speeldagen (${totalSpeeldagen})</h3>
                            
                            <!-- Bulk acties -->
                            <div style="margin-bottom: 20px; display: flex; flex-wrap: wrap; gap: 10px; align-items: center;">
                                <button class="bulk-action-btn" onclick="clearAllSpeeldagen()" style="background: #e74c3c;">
                                     Alle Speeldagen Verwijderen
                                </button>
                            </div>
                            
                            <!-- HEADER -->
                            <div class="speeldagen-list-header">
                                <div>Volgnr</div>
                                <div>Datum</div>
                                <div>Excel Datum</div>
                                <div>Acties</div>
                            </div>
                            
                            <!-- SPEELDAGEN CONTENT -->
                            <div id="speeldagenListContent">
                                ${totalSpeeldagen === 0 ? 
                                    '<div class="empty-speeldagen-message">Geen speeldagen gevonden. Voeg speeldagen toe via het formulier of importeer een CSV.</div>' : 
                                    ''}
                            </div>
                        </div>
                    </div>
                `;
                
                if (totalSpeeldagen > 0) {
                    renderSpeeldagenList();
                }
            }

            function renderSpeeldagenList() {
                const container = document.getElementById('speeldagenListContent');
                if (!container) return;
                
                // Sorteer op volgnummer
                const sortedSpeeldagen = [...state.speeldagen].sort((a, b) => a.volgnummer - b.volgnummer);
                
                // Bouw de speeldagenlijst op
                container.innerHTML = sortedSpeeldagen.map((speeldag, index) => {
                    return `
                        <div class="speeldag-row" id="speeldagRow_${index}">
                            <div>
                                <span class="speeldag-volgnummer">${speeldag.volgnummer}</span>
                            </div>
                            <div>
                                <div class="date-full-format">${speeldag.fullDate || formatDateFull(speeldag.displayDatum)}</div>
                                <div style="font-size: 0.8em; color: #95a5a6;">${speeldag.displayDatum}</div>
                            </div>
                            <div>
                                ${speeldag.excelDatum || '-'}
                            </div>
                            <div class="speeldag-actions">
                                <button class="delete-btn" onclick="deleteSpeeldag(${index})"> Verwijder</button>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            window.addNewSpeeldag = function() {
                const volgnummerInput = document.getElementById('speeldagVolgnummer');
                const datumInput = document.getElementById('speeldagDatum');
                const excelDatumInput = document.getElementById('speeldagExcelDatum');
                
                const volgnummer = parseInt(volgnummerInput.value) || 0;
                const datum = datumInput.value;
                const excelDatum = parseInt(excelDatumInput.value) || null;
                
                if (!volgnummer || volgnummer < 1) {
                    alert('Voer een geldig volgnummer in (minimaal 1)');
                    volgnummerInput.focus();
                    return;
                }
                
                if (!datum) {
                    alert('Selecteer een datum');
                    datumInput.focus();
                    return;
                }
                
                // Check voor dubbele volgnummer
                const existingSpeeldag = state.speeldagen.find(s => s.volgnummer === volgnummer);
                
                if (existingSpeeldag) {
                    if (!confirm(`Speeldag met volgnummer ${volgnummer} bestaat al. Toch toevoegen?`)) {
                        return;
                    }
                }
                
                // Add speeldag
                const newSpeeldag = {
                    volgnummer: volgnummer,
                    jsDatum: new Date(datum),
                    displayDatum: datum,
                    fullDate: formatDateFull(datum),
                    excelDatum: excelDatum
                };
                
                state.speeldagen.push(newSpeeldag);
                
                // Save to storage
                localStorage.setItem('biljartSpeeldagen', JSON.stringify(state.speeldagen));
                
                // Clear form
                volgnummerInput.value = state.speeldagen.length > 0 ? Math.max(...state.speeldagen.map(s => s.volgnummer)) + 1 : 1;
                datumInput.value = formatDateForInput(new Date());
                excelDatumInput.value = '';
                
                // Refresh display
                renderSpeeldagenList();
                updateSpeeldagenBadge();
                
                alert(` Speeldag ${volgnummer} toegevoegd: ${formatDateFull(datum)}`);
                volgnummerInput.focus();
            }

            window.deleteSpeeldag = function(index) {
                if (index < 0 || index >= state.speeldagen.length) return;
                
                const speeldag = state.speeldagen[index];
                
                if (!confirm(`Weet je zeker dat je speeldag ${speeldag.volgnummer} (${speeldag.fullDate}) wilt verwijderen?\n\nDit kan niet ongedaan gemaakt worden.`)) {
                    return;
                }
                
                // Remove speeldag
                state.speeldagen.splice(index, 1);
                
                // Save to storage
                localStorage.setItem('biljartSpeeldagen', JSON.stringify(state.speeldagen));
                
                // Refresh display
                if (state.currentMatchesTab === 'speeldagen') {
                    renderSpeeldagenList();
                    updateSpeeldagenBadge();
                }
                
                alert(` Speeldag ${speeldag.volgnummer} verwijderd!`);
            }

            window.clearAllSpeeldagen = function() {
                if (state.speeldagen.length === 0) {
                    alert("Geen speeldagen om te verwijderen.");
                    return;
                }
                
                if (confirm("Weet je zeker dat je ALLE speeldagen wilt verwijderen? Dit kan niet ongedaan gemaakt worden!")) {
                    state.speeldagen = [];
                    localStorage.setItem('biljartSpeeldagen', JSON.stringify([]));
                    loadSpeeldagenManagementTab();
                }
            }

            window.exportSpeeldagenToCSV = function() {
                if (state.speeldagen.length === 0) {
                    alert('Geen speeldagen om te exporteren.');
                    return;
                }
                
                let csvContent = "VolgnummerSpeeldag;ExcelDatum;VolledigeDatum\n";
                
                // Sorteer op volgnummer
                const sortedSpeeldagen = [...state.speeldagen].sort((a, b) => a.volgnummer - b.volgnummer);
                
                sortedSpeeldagen.forEach(speeldag => {
                    csvContent += `${speeldag.volgnummer};${speeldag.excelDatum || ''};"${speeldag.fullDate}"\n`;
                });
                
                const blob = new Blob(["\uFEFF" + csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement("a");
                const url = URL.createObjectURL(blob);
                link.setAttribute("href", url);
                link.setAttribute("download", `biljart_speeldagen_${new Date().toISOString().split('T')[0]}.csv`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                alert(` ${state.speeldagen.length} speeldagen gexporteerd naar CSV!`);
            }

            function updateSpeeldagenBadge() {
                const badge = document.getElementById('badgeSpeeldagen');
                if (badge) {
                    badge.textContent = state.speeldagen.length;
                }
            }

            // ==================== MATCHES TAB FUNCTIES ====================
            function loadMatchesTabContent() {
                updateTabBadges();
                
                if (state.currentMatchesTab === 'active') {
                    loadActiveMatches();
                } else if (state.currentMatchesTab === 'completed') {
                    loadCompletedMatches();
                } else if (state.currentMatchesTab === 'downloaded') {
                    loadDownloadedMatches();
                } else if (state.currentMatchesTab === 'players') {
                    loadPlayersManagementTab();
                } else if (state.currentMatchesTab === 'speeldagen') {
                    loadSpeeldagenManagementTab();
                }
            }

            function updateTabBadges() {
                const activeCount = state.matches.filter(m => !m.completed).length;
                const completedCount = state.matches.filter(m => m.completed).length;
                const downloadedCount = state.downloadedMatches.length;
                const playersCount = state.players.length;
                const speeldagenCount = state.speeldagen.length;
                
                document.getElementById('badgeActive').textContent = activeCount;
                document.getElementById('badgeCompleted').textContent = completedCount;
                document.getElementById('badgeDownloaded').textContent = downloadedCount;
                document.getElementById('badgePlayers').textContent = playersCount;
                document.getElementById('badgeSpeeldagen').textContent = speeldagenCount;
            }

            function loadActiveMatches() {
                const container = document.getElementById('tabContentActive');
                const activeMatches = state.matches.filter(match => !match.completed);
                
                if (activeMatches.length === 0) {
                    container.innerHTML = `
                        <div class="no-matches">
                            <p>Geen actieve matchen</p>
                            <p><small>Maak nieuwe matchen aan via de startpagina</small></p>
                        </div>
                    `;
                    return;
                }
                
                const matchesByDate = {};
                activeMatches.forEach(match => {
                    if (!matchesByDate[match.date]) {
                        matchesByDate[match.date] = [];
                    }
                    matchesByDate[match.date].push(match);
                });
                
                const sortedDates = Object.keys(matchesByDate).sort((a, b) => new Date(b) - new Date(a));
                
                let html = '<div class="matches-list-title">Actieve Matchen (' + activeMatches.length + ')</div>';
                
                html += `
                    <button class="clear-all-btn" onclick="clearAllActiveMatches()">
                         Alle Actieve Matchen Verwijderen
                    </button>
                    <div style="margin-bottom: 20px;"></div>
                `;
                
                sortedDates.forEach(date => {
                    const displayDate = formatDateDisplay(date);
                    const dateMatches = matchesByDate[date];
                    
                    html += `
                        <div style="margin-bottom: 20px;">
                            <h3 style="color: #3498db; border-bottom: 1px solid #34495e; padding-bottom: 5px;">
                                 ${displayDate} (${dateMatches.length} matchen)
                            </h3>
                    `;
                    
                    dateMatches.forEach(match => {
                        html += `
                            <div class="match-card" style="cursor: default;">
                                <button class="delete-match-btn" onclick="deleteMatch(${match.id})" title="Match verwijderen"></button>
                                <h3>${match.p1} vs ${match.p2}
                                    <span class="status-badge status-pending">In afwachting</span>
                                </h3>
                                <p class="match-info">
                                     Doelpunten: ${match.target1} - ${match.target2}<br>
                                     Datum: ${formatDateDisplay(match.date)}
                                </p>
                                <div class="match-actions">
                                    <button onclick="selectMatch(${match.id})" class="action-btn-small" style="background: #2ecc71;">
                                         Speel Match
                                    </button>
                                </div>
                            </div>
                        `;
                    });
                    
                    html += `</div>`;
                });
                
                container.innerHTML = html;
            }

            function loadCompletedMatches() {
                const container = document.getElementById('tabContentCompleted');
                const completedMatches = state.matches.filter(match => match.completed);
                
                if (completedMatches.length === 0) {
                    container.innerHTML = `
                        <div class="no-matches">
                            <p>Geen voltooide matchen</p>
                            <p><small>Speel eerst matchen om ze hier te zien</small></p>
                        </div>
                    `;
                    return;
                }
                
                const matchesByDate = {};
                completedMatches.forEach(match => {
                    if (!matchesByDate[match.date]) {
                        matchesByDate[match.date] = [];
                    }
                    matchesByDate[match.date].push(match);
                });
                
                const sortedDates = Object.keys(matchesByDate).sort((a, b) => new Date(b) - new Date(a));
                
                let html = '<div class="matches-list-title">Voltooide Matchen (' + completedMatches.length + ')</div>';
                
                html += `
                    <div style="margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="download-btn" onclick="downloadAllResults()">
                             Download Alles
                        </button>
                        <button class="clear-all-btn" onclick="clearAllCompletedMatches()">
                             Alle Voltooide Matchen Verwijderen
                        </button>
                    </div>
                `;
                
                sortedDates.forEach(date => {
                    const displayDate = formatDateDisplay(date);
                    const dateMatches = matchesByDate[date];
                    
                    html += `
                        <div style="margin-bottom: 20px;">
                            <h3 style="color: #27ae60; border-bottom: 1px solid #34495e; padding-bottom: 5px;">
                                 ${displayDate} (${dateMatches.length} matchen)
                            </h3>
                    `;
                    
                    dateMatches.forEach(match => {
                        const winner = match.winner || (match.p1Score >= match.target1 ? match.p1 : match.p2);
                        
                        html += `
                            <div class="match-card completed" style="cursor: default;">
                                <button class="delete-match-btn" onclick="deleteMatch(${match.id})" title="Match verwijderen"></button>
                                <h3>${match.p1} vs ${match.p2}
                                    <span class="status-badge status-completed">Voltooid</span>
                                </h3>
                                <p class="match-info">
                                     Doelpunten: ${match.target1} - ${match.target2}<br>
                                     Eindscore: ${match.p1Score || 0} - ${match.p2Score || 0}<br>
                                     Winnaar: ${winner}<br>
                                     Datum: ${formatDateDisplay(match.date)}
                                </p>
                                <div class="match-actions">
                                    <button onclick="downloadSingleMatch(${match.id})" class="action-btn-small" style="background: #2ecc71;">
                                         Download
                                    </button>
                                </div>
                            </div>
                        `;
                    });
                    
                    html += `</div>`;
                });
                
                container.innerHTML = html;
            }

            function loadDownloadedMatches() {
                const container = document.getElementById('tabContentDownloaded');
                
                if (state.downloadedMatches.length === 0) {
                    container.innerHTML = `
                        <div class="no-matches">
                            <p>Geen gedownloade matchen</p>
                            <p><small>Download voltooide matchen om ze hier te zien</small></p>
                        </div>
                    `;
                    return;
                }
                
                const matchesByDate = {};
                state.downloadedMatches.forEach(match => {
                    if (!matchesByDate[match.date]) {
                        matchesByDate[match.date] = [];
                    }
                    matchesByDate[match.date].push(match);
                });
                
                const sortedDates = Object.keys(matchesByDate).sort((a, b) => new Date(b) - new Date(a));
                
                let html = '<div class="matches-list-title">Gedownloade Matchen (' + state.downloadedMatches.length + ')</div>';
                
                html += `
                    <button class="clear-all-btn" onclick="clearAllDownloadedMatches()">
                         Alle Gedownloade Matchen Verwijderen
                    </button>
                    <div style="margin-bottom: 20px;"></div>
                `;
                
                sortedDates.forEach(date => {
                    const displayDate = formatDateDisplay(date);
                    const dateMatches = matchesByDate[date];
                    
                    html += `
                        <div style="margin-bottom: 20px;">
                            <h3 style="color: #3498db; border-bottom: 1px solid #34495e; padding-bottom: 5px;">
                                 ${displayDate} (${dateMatches.length} matchen)
                            </h3>
                    `;
                    
                    dateMatches.forEach((match, index) => {
                        const globalIndex = state.downloadedMatches.findIndex(m => 
                            m.id === match.id && 
                            m.date === match.date
                        );
                        
                        const winner = match.winner || (match.p1Score >= match.target1 ? match.p1 : match.p2);
                        
                        html += `
                            <div class="match-card downloaded" style="cursor: default;">
                                <button class="delete-match-btn" onclick="deleteDownloadedMatch(${globalIndex})" title="Match verwijderen"></button>
                                <h3>${match.p1} vs ${match.p2}
                                    <span class="status-badge status-downloaded">Gedownload</span>
                                </h3>
                                <p class="match-info">
                                     Doelpunten: ${match.target1} - ${match.target2}<br>
                                     Eindscore: ${match.p1Score || 0} - ${match.p2Score || 0}<br>
                                     Winnaar: ${winner}<br>
                                     Datum: ${formatDateDisplay(match.date)}
                                </p>
                            </div>
                        `;
                    });
                    
                    html += `</div>`;
                });
                
                container.innerHTML = html;
            }

            window.deleteMatch = function(matchId) {
                const matchIndex = state.matches.findIndex(m => m.id === matchId);
                if (matchIndex !== -1) {
                    const match = state.matches[matchIndex];
                    if (confirm(`Weet je zeker dat je deze match wilt verwijderen?\n\n${match.p1} vs ${match.p2}`)) {
                        state.matches.splice(matchIndex, 1);
                        saveStateToStorage();
                        loadMatchesTabContent();
                        
                        if (state.currentPage === 2) {
                            loadFilteredMatches();
                        }
                    }
                }
            }

            window.deleteDownloadedMatch = function(downloadedIndex) {
                if (downloadedIndex >= 0 && downloadedIndex < state.downloadedMatches.length) {
                    const match = state.downloadedMatches[downloadedIndex];
                    if (confirm(`Weet je zeker dat je deze gedownloade match wilt verwijderen?\n\n${match.p1} vs ${match.p2}`)) {
                        state.downloadedMatches.splice(downloadedIndex, 1);
                        saveStateToStorage();
                        loadMatchesTabContent();
                    }
                }
            }

            window.clearAllActiveMatches = function() {
                const activeMatches = state.matches.filter(m => !m.completed);
                if (activeMatches.length === 0) {
                    alert("Geen actieve matchen om te verwijderen.");
                    return;
                }
                
                if (confirm(`Weet je zeker dat je ALLE ${activeMatches.length} actieve matchen wilt verwijderen? Dit kan niet ongedaan gemaakt worden!`)) {
                    state.matches = state.matches.filter(m => m.completed);
                    saveStateToStorage();
                    loadMatchesTabContent();
                    alert(`${activeMatches.length} actieve matchen verwijderd.`);
                }
            }

            window.clearAllCompletedMatches = function() {
                const completedMatches = state.matches.filter(m => m.completed);
                if (completedMatches.length === 0) {
                    alert("Geen voltooide matchen om te verwijderen.");
                    return;
                }
                
                if (confirm(`Weet je zeker dat je ALLE ${completedMatches.length} voltooide matchen wilt verwijderen? Dit kan niet ongedaan gemaakt worden!`)) {
                    state.matches = state.matches.filter(m => !m.completed);
                    saveStateToStorage();
                    loadMatchesTabContent();
                    alert(`${completedMatches.length} voltooide matchen verwijderd.`);
                }
            }

            window.clearAllDownloadedMatches = function() {
                if (state.downloadedMatches.length === 0) {
                    alert("Geen gedownloade matchen om te verwijderen.");
                    return;
                }
                
                if (confirm(`Weet je zeker dat je ALLE ${state.downloadedMatches.length} gedownloade matchen wilt verwijderen? Dit kan niet ongedaan gemaakt worden!`)) {
                    state.downloadedMatches = [];
                    saveStateToStorage();
                    loadMatchesTabContent();
                    alert(`${state.downloadedMatches.length} gedownloade matchen verwijderd.`);
                }
            }

            // ==================== DOWNLOAD FUNCTIES ====================
            window.downloadAllResults = function() {
                const completedMatches = state.matches.filter(m => m.completed);

                if (completedMatches.length === 0) {
                    alert("Geen voltooide matches om te downloaden.");
                    return;
                }
                
                if (confirm(`Er zijn ${completedMatches.length} voltooide matches gevonden. Wilt u deze downloaden en naar gedownloade matchen verplaatsen?`)) {
                    downloadMatchesAsCSV(completedMatches, 'voltooide_resultaten');
                    
                    completedMatches.forEach(match => {
                        state.downloadedMatches.push({
                            ...match,
                            downloadedDate: new Date().toISOString()
                        });
                    });
                    
                    state.matches = state.matches.filter(m => !m.completed);
                    
                    saveStateToStorage();
                    loadMatchesTabContent();
                    
                    alert(` ${completedMatches.length} matches gedownload en naar gedownloade matchen verplaatst.`);
                }
            }

            window.downloadSingleMatch = function(matchId) {
                const matchIndex = state.matches.findIndex(m => m.id === matchId);
                if (matchIndex !== -1 && state.matches[matchIndex].completed) {
                    const match = state.matches[matchIndex];
                    if (confirm(`Wilt u de match tussen ${match.p1} en ${match.p2} downloaden en naar gedownloade matchen verplaatsen?`)) {
                        downloadMatchesAsCSV([match], `match_${match.p1}_vs_${match.p2}`);
                        
                        state.downloadedMatches.push({
                            ...match,
                            downloadedDate: new Date().toISOString()
                        });
                        
                        state.matches.splice(matchIndex, 1);
                        
                        saveStateToStorage();
                        loadMatchesTabContent();
                        
                        alert(`Match gedownload en naar gedownloade matchen verplaatst.`);
                    }
                }
            }

            window.downloadFilteredResults = function() {
                const filterDate = document.getElementById('filterDate').value;
                let filteredMatches;
                
                if (filterDate) {
                    filteredMatches = state.matches.filter(m => m.completed && m.date === filterDate);
                } else {
                    filteredMatches = state.matches.filter(m => m.completed);
                }
                
                if (filteredMatches.length === 0) {
                    alert("Geen voltooide matches gevonden voor deze filter.");
                    return;
                }
                
                const dateStr = filterDate || 'alle';
                if (confirm(`Er zijn ${filteredMatches.length} voltooide matches gevonden. Wilt u deze downloaden en naar gedownloade matchen verplaatsen?`)) {
                    downloadMatchesAsCSV(filteredMatches, `resultaten_${dateStr}`);
                    
                    filteredMatches.forEach(match => {
                        state.downloadedMatches.push({
                            ...match,
                            downloadedDate: new Date().toISOString()
                        });
                    });
                    
                    state.matches = state.matches.filter(m => !(m.completed && (!filterDate || m.date === filterDate)));
                    
                    saveStateToStorage();
                    loadMatchesTabContent();
                    
                    alert(` ${filteredMatches.length} matches gedownload en naar gedownloade matchen verplaatst.`);
                }
            }

            function downloadMatchesAsCSV(matches, filename) {
                let csvContent = "\uFEFF"; // UTF-8 BOM
                
                csvContent += "Datum;Match ID;Speler 1;Speler 2;Doel 1;Doel 2;Score 1;Score 2;Winnende Speler;Wit Speler;Hoogste Reeks 1;Hoogste Reeks 2;Gemiddelde 1;Gemiddelde 2;Beurten 1;Beurten 2;Regel\n";

                matches.forEach(match => {
                    const p1 = match.originalP1 || match.p1;
                    const p2 = match.originalP2 || match.p2;
                    const target1 = match.originalTarget1 || match.target1;
                    const target2 = match.originalTarget2 || match.target2;
                    const p1Score = match.p1Score || 0;
                    const p2Score = match.p2Score || 0;
                    
                    const p1TurnsCount = match.p1Turns ? match.p1Turns.length : 0;
                    const p2TurnsCount = match.p2Turns ? match.p2Turns.length : 0;
                    
                    const avg1 = p1TurnsCount > 0 ? 
                        (p1Score / p1TurnsCount).toFixed(2).replace('.', ',') : "0,00";
                    const avg2 = p2TurnsCount > 0 ? 
                        (p2Score / p2TurnsCount).toFixed(2).replace('.', ',') : "0,00";
                    
                    const witSpeler = match.whitePlayer === 1 ? 
                        (match.originalP1 || match.p1) : 
                        (match.originalP2 || match.p2);
                    
                    const winnaar = match.winner || (p1Score >= target1 ? p1 : p2);
                    
                    // Bepaal welke regel er werd toegepast
                    let regel = "Normaal";
                    if (match.winner === p1) {
                        regel = "Speler 1 won (eerste target) - nabeurt Speler 2";
                    } else if (match.winner === p2) {
                        regel = "Speler 2 won (eerste target) - geen nabeurt";
                    }
                    
                    csvContent += `${formatDateForCSV(match.date)};${match.id};${p1};${p2};${target1};${target2};`;
                    csvContent += `${p1Score};${p2Score};`;
                    csvContent += `${winnaar};${witSpeler};`;
                    csvContent += `${match.p1Highest || 0};${match.p2Highest || 0};${avg1};${avg2};`;
                    csvContent += `${p1TurnsCount};${p2TurnsCount};${regel}\n`;
                });
            
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement("a");
                const url = URL.createObjectURL(blob);
                link.setAttribute("href", url);
                link.setAttribute("download", `biljart_${filename}_${new Date().toISOString().split('T')[0]}.csv`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }

            // ==================== STATE MANAGEMENT ====================
            function saveStateToStorage() {
                const stateToSave = {
                    players: state.players,
                    matches: state.matches,
                    downloadedMatches: state.downloadedMatches,
                    speeldagen: state.speeldagen
                };
                localStorage.setItem('billiardState', JSON.stringify(stateToSave));
            }

            function loadStateFromStorage() {
                const saved = localStorage.getItem('billiardState');
                if (saved) {
                    try {
                        const parsed = JSON.parse(saved);
                        state.players = parsed.players || [];
                        state.matches = parsed.matches || [];
                        state.downloadedMatches = parsed.downloadedMatches || [];
                        state.speeldagen = parsed.speeldagen || [];
                    } catch (e) {
                        console.error('Fout bij laden opgeslagen staat:', e);
                    }
                }
            }
	    // In initializeApp(), na loadStateFromStorage():
	    function loadExtraDataFromStorage() {
	        try {
	            // Laad speeldagen
	            const savedSpeeldagen = localStorage.getItem('biljartSpeeldagen');
	            if (savedSpeeldagen) {
	                state.speeldagen = JSON.parse(savedSpeeldagen);
	                console.log(` ${state.speeldagen.length} speeldagen geladen`);
	            }
        
	            // Laad speler extra info
	            const savedExtraInfo = localStorage.getItem('biljartSpelerExtraInfo');
	            if (savedExtraInfo) {
	                state.spelerExtraInfo = JSON.parse(savedExtraInfo);
	                console.log(` ${state.spelerExtraInfo.length} spelers extra info geladen`);
	            }
	            
	            // Laad seizoen
	            const savedSeizoen = localStorage.getItem('biljartCurrentSeizoen');
	            if (savedSeizoen) {
	                state.currentSeizoen = savedSeizoen;
	                console.log(` Seizoen geladen: ${state.currentSeizoen}`);
	            }
	        } catch (error) {
	            console.error("Fout bij laden extra data:", error);
	        }
	    }

	    // Roep aan in initializeApp():
	    loadExtraDataFromStorage();

            // ==================== INITIALISATIE ====================
            clearOldCache();
            
            // Zet standaard wachtwoord als er nog geen is
            if (!localStorage.getItem('biljartAdminPassword')) {
                setAdminPassword(DEFAULT_ADMIN_PASSWORD);
            }
            
            loadStateFromStorage();
            
            const today = new Date();
            const dateInput = document.getElementById('dateSelect');
            if (dateInput) {
                dateInput.value = formatDateForInput(today);
                dateInput.addEventListener('change', function() {
                    state.selectedDate = this.value;
                });
            }
            
            updateTabBadges();
            
            // Probeer eerst spelers van GitHub te laden
            //loadPlayersFromGitHub();//
         
            // Toon pagina 1
            showPage(1);

        }
    </script>

    <!-- Na al je bestaande scripts -->
    <script src="stats.js"></script>

</body>
</html>




